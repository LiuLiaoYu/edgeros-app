import{c as N,f as k,n as $,d as C,r as P,h as R,i as U,j,k as G,l as I,a,L as M,p as Y,q,s as z,w as X,t as B,v as i,u as w,x as b,o as y,e as E,b as J,y as K,F as O,z as Q,A as H}from"./index-bxAwNUOc.js";import{u as W,B as Z}from"./use-auth-fetch-cDbqrelx.js";import{C as tt,a as et}from"./index-BGpwZa6W.js";import{P as st}from"./index-DDy8tDK5.js";import"./use-scope-id-oJtDJdps.js";const[at,p,nt]=N("pull-refresh"),A=50,ot=["pulling","loosing","success"],lt={disabled:Boolean,modelValue:Boolean,headHeight:k(A),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:$,successDuration:k(500),animationDuration:k(300)};var ut=C({name:at,props:lt,emits:["change","refresh","update:modelValue"],setup(s,{emit:c,slots:r}){let d;const f=P(),_=P(),x=R(f),e=U({status:"normal",distance:0,duration:0}),o=j(),h=()=>{if(s.headHeight!==A)return{height:`${s.headHeight}px`}},m=()=>e.status!=="loading"&&e.status!=="success"&&!s.disabled,g=t=>{const n=+(s.pullDistance||s.headHeight);return t>n&&(t<n*2?t=n+(t-n)/2:t=n*1.5+(t-n*2)/4),Math.round(t)},l=(t,n)=>{const v=+(s.pullDistance||s.headHeight);e.distance=t,n?e.status="loading":t===0?e.status="normal":t<v?e.status="pulling":e.status="loosing",c("change",{status:e.status,distance:t})},T=()=>{const{status:t}=e;return t==="normal"?"":s[`${t}Text`]||nt(t)},u=()=>{const{status:t,distance:n}=e;if(r[t])return r[t]({distance:n});const v=[];return ot.includes(t)&&v.push(a("div",{class:p("text")},[T()])),t==="loading"&&v.push(a(M,{class:p("loading")},{default:T})),v},S=()=>{e.status="success",setTimeout(()=>{l(0)},+s.successDuration)},D=t=>{d=q(x.value)===0,d&&(e.duration=0,o.start(t))},F=t=>{m()&&D(t)},L=t=>{if(m()){d||D(t);const{deltaY:n}=o;o.move(t),d&&n.value>=0&&o.isVertical()&&(z(t),l(g(n.value)))}},V=()=>{d&&o.deltaY.value&&m()&&(e.duration=+s.animationDuration,e.status==="loosing"?(l(+s.headHeight,!0),c("update:modelValue",!0),Y(()=>c("refresh"))):l(0))};return G(()=>s.modelValue,t=>{e.duration=+s.animationDuration,t?l(+s.headHeight,!0):r.success||s.successText?S():l(0,!1)}),I("touchmove",L,{target:_}),()=>{var t;const n={transitionDuration:`${e.duration}ms`,transform:e.distance?`translate3d(0,${e.distance}px, 0)`:""};return a("div",{ref:f,class:p()},[a("div",{ref:_,class:p("track"),style:n,onTouchstartPassive:F,onTouchend:V,onTouchcancel:V},[a("div",{class:p("head"),style:h()},[u()]),(t=r.default)==null?void 0:t.call(r)])])}}});const it=X(ut),ct={"w-100vw":""},gt=C({__name:"action",setup(s){const{isFetching:c,data:r,execute:d}=W("/api/device/list").json(),f=P(!1);function _(){f.value=!0}function x(){d()}return(e,o)=>{const h=tt,m=et,g=Z,l=st,T=it;return y(),B(T,{modelValue:w(c),"onUpdate:modelValue":o[2]||(o[2]=u=>b(c)?c.value=u:null),onRefresh:x},{default:i(()=>[E("div",ct,[a(m,{title:"可控制设备"},{default:i(()=>[(y(!0),J(O,null,K(w(r).list,(u,S)=>(y(),B(h,{key:S,title:u.label,value:u.devid,onClick:o[0]||(o[0]=D=>_())},null,8,["title","value"]))),128))]),_:1}),a(m,{title:"预设手势"},{default:i(()=>[a(h,{title:"单元格",value:"内容"}),a(h,{title:"单元格",value:"内容"})]),_:1}),a(m,{title:"动作"},{default:i(()=>[a(h,{title:"单元格",value:"内容"}),a(h,{title:"单元格",value:"内容"})]),_:1})]),a(l,{show:w(f),"onUpdate:show":o[1]||(o[1]=u=>b(f)?f.value=u:null),position:"bottom",round:"",style:{height:"50%","padding-top":"3em"}},{default:i(()=>[E("div",null,"状态："+Q(),1),a(g,{type:""},{default:i(()=>[H(" 开 ")]),_:1}),a(g,{type:""},{default:i(()=>[H(" 关 ")]),_:1}),a(g,{type:""},{default:i(()=>[H(" 切换 ")]),_:1})]),_:1},8,["show"])]),_:1},8,["modelValue"])}}});export{gt as default};
