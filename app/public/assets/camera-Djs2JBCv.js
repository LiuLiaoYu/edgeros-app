import{c as Be,d as Ae,B as ot,a as Q,n as Pe,C as we,D as Qe,s as Ie,w as Fe,E as lt,G as ut,H as dt,I as ft,J as ht,m as be,f as ct,K as _t,M as pt,i as mt,r as me,N as vt,O as ye,P as Ke,Q as gt,R as xt,k as Et,p as Te,S as Ze,l as yt,T as Se,U as ze,V as St,W as De,X as bt,A as Le,Y as Lt,Z as At,_ as Rt,$ as Ot,a0 as Ct,a1 as Tt,o as Me,b as Ge,e as _e,z as We,u as ce,v as ue,x as je,F as It,y as Dt,t as Mt}from"./index-CnDVkyK8.js";import{B as Je,u as He}from"./use-auth-fetch-99ALzgbY.js";import{c as Pt,C as qe,a as wt}from"./index-k2CdevVo.js";import{u as Bt}from"./use-id-DAxqJ6IQ.js";import{u as et,P as Ft}from"./index-C0HipcY9.js";import"./use-scope-id-Dssc9r5O.js";const[kt,Ut]=Be("form"),jt={colon:Boolean,disabled:Boolean,readonly:Boolean,required:[Boolean,String],showError:Boolean,labelWidth:Pe,labelAlign:String,inputAlign:String,scrollToError:Boolean,validateFirst:Boolean,submitOnEnter:we,showErrorMessage:we,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var Nt=Ae({name:kt,props:jt,emits:["submit","failed"],setup(A,{emit:U,slots:F}){const{children:J,linkChildren:P}=ot(Qe),Y=o=>o?J.filter(r=>o.includes(r.name)):J,T=o=>new Promise((r,t)=>{const a=[];Y(o).reduce((e,d)=>e.then(()=>{if(!a.length)return d.validate().then(c=>{c&&a.push(c)})}),Promise.resolve()).then(()=>{a.length?t(a):r()})}),S=o=>new Promise((r,t)=>{const a=Y(o);Promise.all(a.map(i=>i.validate())).then(i=>{i=i.filter(Boolean),i.length?t(i):r()})}),p=o=>{const r=J.find(t=>t.name===o);return r?new Promise((t,a)=>{r.validate().then(i=>{i?a(i):t()})}):Promise.reject()},E=o=>typeof o=="string"?p(o):A.validateFirst?T(o):S(o),h=o=>{typeof o=="string"&&(o=[o]),Y(o).forEach(t=>{t.resetValidation()})},u=()=>J.reduce((o,r)=>(o[r.name]=r.getValidationStatus(),o),{}),s=(o,r)=>{J.some(t=>t.name===o?(t.$el.scrollIntoView(r),!0):!1)},f=()=>J.reduce((o,r)=>(r.name!==void 0&&(o[r.name]=r.formValue.value),o),{}),n=()=>{const o=f();E().then(()=>U("submit",o)).catch(r=>{U("failed",{values:o,errors:r}),A.scrollToError&&r[0].name&&s(r[0].name)})},l=o=>{Ie(o),n()};return P({props:A}),et({submit:n,validate:E,getValues:f,scrollToField:s,resetValidation:h,getValidationStatus:u}),()=>{var o;return Q("form",{class:Ut(),onSubmit:l},[(o=F.default)==null?void 0:o.call(F)])}}});const Vt=Fe(Nt);function tt(A){return Array.isArray(A)?!A.length:A===0?!1:!A}function Gt(A,U){if(tt(A)){if(U.required)return!1;if(U.validateEmpty===!1)return!0}return!(U.pattern&&!U.pattern.test(String(A)))}function Wt(A,U){return new Promise(F=>{const J=U.validator(A,U);if(dt(J)){J.then(F);return}F(J)})}function Ye(A,U){const{message:F}=U;return ft(F)?F(A,U):F||""}function Kt({target:A}){A.composing=!0}function Xe({target:A}){A.composing&&(A.composing=!1,A.dispatchEvent(new Event("input")))}function zt(A,U){const F=lt();A.style.height="auto";let J=A.scrollHeight;if(ht(U)){const{maxHeight:P,minHeight:Y}=U;P!==void 0&&(J=Math.min(J,P)),Y!==void 0&&(J=Math.max(J,Y))}J&&(A.style.height=`${J}px`,ut(F))}function Ht(A){return A==="number"?{type:"text",inputmode:"decimal"}:A==="digit"?{type:"tel",inputmode:"numeric"}:{type:A}}function he(A){return[...A].length}function Ne(A,U){return[...A].slice(0,U).join("")}const[Yt,le]=Be("field"),Xt={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:Pe,formatter:Function,clearIcon:be("clear"),modelValue:ct(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:be("focus"),formatTrigger:be("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},$t=_t({},Pt,Xt,{rows:Pe,type:be("text"),rules:Array,autosize:[Boolean,Object],labelWidth:Pe,labelClass:pt,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}});var Qt=Ae({name:Yt,props:$t,emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(A,{emit:U,slots:F}){const J=Bt(),P=mt({status:"unvalidated",focused:!1,validateMessage:""}),Y=me(),T=me(),S=me(),{parent:p}=vt(Qe),E=()=>{var L;return String((L=A.modelValue)!=null?L:"")},h=L=>{if(Se(A[L]))return A[L];if(p&&Se(p.props[L]))return p.props[L]},u=ye(()=>{const L=h("readonly");if(A.clearable&&!L){const j=E()!=="",k=A.clearTrigger==="always"||A.clearTrigger==="focus"&&P.focused;return j&&k}return!1}),s=ye(()=>S.value&&F.input?S.value():A.modelValue),f=ye(()=>{var L;const j=h("required");return j==="auto"?(L=A.rules)==null?void 0:L.some(k=>k.required):j}),n=L=>L.reduce((j,k)=>j.then(()=>{if(P.status==="failed")return;let{value:$}=s;if(k.formatter&&($=k.formatter($,k)),!Gt($,k)){P.status="failed",P.validateMessage=Ye($,k);return}if(k.validator)return tt($)&&k.validateEmpty===!1?void 0:Wt($,k).then(ee=>{ee&&typeof ee=="string"?(P.status="failed",P.validateMessage=ee):ee===!1&&(P.status="failed",P.validateMessage=Ye($,k))})}),Promise.resolve()),l=()=>{P.status="unvalidated",P.validateMessage=""},o=()=>U("endValidate",{status:P.status,message:P.validateMessage}),r=(L=A.rules)=>new Promise(j=>{l(),L?(U("startValidate"),n(L).then(()=>{P.status==="failed"?(j({name:A.name,message:P.validateMessage}),o()):(P.status="passed",j(),o())})):j()}),t=L=>{if(p&&A.rules){const{validateTrigger:j}=p.props,k=ze(j).includes(L),$=A.rules.filter(ee=>ee.trigger?ze(ee.trigger).includes(L):k);$.length&&r($)}},a=L=>{var j;const{maxlength:k}=A;if(Se(k)&&he(L)>+k){const $=E();if($&&he($)===+k)return $;const ee=(j=Y.value)==null?void 0:j.selectionEnd;if(P.focused&&ee){const z=[...L],w=z.length-+k;return z.splice(ee-w,w),z.join("")}return Ne(L,+k)}return L},i=(L,j="onChange")=>{const k=L;L=a(L);const $=he(k)-he(L);if(A.type==="number"||A.type==="digit"){const z=A.type==="number";L=St(L,z,z)}let ee=0;if(A.formatter&&j===A.formatTrigger){const{formatter:z,maxlength:w}=A;if(L=z(L),Se(w)&&he(L)>+w&&(L=Ne(L,+w)),Y.value&&P.focused){const{selectionEnd:re}=Y.value,se=Ne(k,re);ee=he(z(se))-he(se)}}if(Y.value&&Y.value.value!==L)if(P.focused){let{selectionStart:z,selectionEnd:w}=Y.value;if(Y.value.value=L,Se(z)&&Se(w)){const re=he(L);$?(z-=$,w-=$):ee&&(z+=ee,w+=ee),Y.value.setSelectionRange(Math.min(z,re),Math.min(w,re))}}else Y.value.value=L;L!==A.modelValue&&U("update:modelValue",L)},e=L=>{L.target.composing||i(L.target.value)},d=()=>{var L;return(L=Y.value)==null?void 0:L.blur()},c=()=>{var L;return(L=Y.value)==null?void 0:L.focus()},_=()=>{const L=Y.value;A.type==="textarea"&&A.autosize&&L&&zt(L,A.autosize)},v=L=>{P.focused=!0,U("focus",L),Te(_),h("readonly")&&d()},y=L=>{P.focused=!1,i(E(),"onBlur"),U("blur",L),!h("readonly")&&(t("onBlur"),Te(_),Lt())},x=L=>U("clickInput",L),m=L=>U("clickLeftIcon",L),g=L=>U("clickRightIcon",L),b=L=>{Ie(L),U("update:modelValue",""),U("clear",L)},C=ye(()=>{if(typeof A.error=="boolean")return A.error;if(p&&p.props.showError&&P.status==="failed")return!0}),O=ye(()=>{const L=h("labelWidth"),j=h("labelAlign");if(L&&j!=="top")return{width:Ke(L)}}),M=L=>{L.keyCode===13&&(!(p&&p.props.submitOnEnter)&&A.type!=="textarea"&&Ie(L),A.type==="search"&&d()),U("keypress",L)},G=()=>A.id||`${J}-input`,W=()=>P.status,V=()=>{const L=le("control",[h("inputAlign"),{error:C.value,custom:!!F.input,"min-height":A.type==="textarea"&&!A.autosize}]);if(F.input)return Q("div",{class:L,onClick:x},[F.input()]);const j={id:G(),ref:Y,name:A.name,rows:A.rows!==void 0?+A.rows:void 0,class:L,disabled:h("disabled"),readonly:h("readonly"),autofocus:A.autofocus,placeholder:A.placeholder,autocomplete:A.autocomplete,autocapitalize:A.autocapitalize,autocorrect:A.autocorrect,enterkeyhint:A.enterkeyhint,spellcheck:A.spellcheck,"aria-labelledby":A.label?`${J}-label`:void 0,onBlur:y,onFocus:v,onInput:e,onClick:x,onChange:Xe,onKeypress:M,onCompositionend:Xe,onCompositionstart:Kt};return A.type==="textarea"?Q("textarea",j,null):Q("input",bt(Ht(A.type),j),null)},X=()=>{const L=F["left-icon"];if(A.leftIcon||L)return Q("div",{class:le("left-icon"),onClick:m},[L?L():Q(De,{name:A.leftIcon,classPrefix:A.iconPrefix},null)])},te=()=>{const L=F["right-icon"];if(A.rightIcon||L)return Q("div",{class:le("right-icon"),onClick:g},[L?L():Q(De,{name:A.rightIcon,classPrefix:A.iconPrefix},null)])},N=()=>{if(A.showWordLimit&&A.maxlength){const L=he(E());return Q("div",{class:le("word-limit")},[Q("span",{class:le("word-num")},[L]),Le("/"),A.maxlength])}},Z=()=>{if(p&&p.props.showErrorMessage===!1)return;const L=A.errorMessage||P.validateMessage;if(L){const j=F["error-message"],k=h("errorMessageAlign");return Q("div",{class:le("error-message",k)},[j?j({message:L}):L])}},ae=()=>{const L=h("labelWidth"),j=h("labelAlign"),k=h("colon")?":":"";if(F.label)return[F.label(),k];if(A.label)return Q("label",{id:`${J}-label`,for:F.input?void 0:G(),onClick:$=>{Ie($),c()},style:j==="top"&&L?{width:Ke(L)}:void 0},[A.label+k])},q=()=>[Q("div",{class:le("body")},[V(),u.value&&Q(De,{ref:T,name:A.clearIcon,class:le("clear")},null),te(),F.button&&Q("div",{class:le("button")},[F.button()])]),N(),Z()];return et({blur:d,focus:c,validate:r,formValue:s,resetValidation:l,getValidationStatus:W}),gt(xt,{customValue:S,resetValidation:l,validateWithTrigger:t}),Et(()=>A.modelValue,()=>{i(E()),l(),t("onChange"),Te(_)}),Ze(()=>{i(E(),A.formatTrigger),Te(_)}),yt("touchstart",b,{target:ye(()=>{var L;return(L=T.value)==null?void 0:L.$el})}),()=>{const L=h("disabled"),j=h("labelAlign"),k=X(),$=()=>{const ee=ae();return j==="top"?[k,ee].filter(Boolean):ee||[]};return Q(qe,{size:A.size,class:le({error:C.value,disabled:L,[`label-${j}`]:j}),center:A.center,border:A.border,isLink:A.isLink,clickable:A.clickable,titleStyle:O.value,valueClass:le("value"),titleClass:[le("label",[j,{required:f.value}]),A.labelClass],arrowDirection:A.arrowDirection},{icon:k&&j!=="top"?()=>k:null,title:$,value:q,extra:F.extra})}}});const Zt=Fe(Qt),[Jt,$e]=Be("tag"),qt={size:String,mark:Boolean,show:we,type:be("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var er=Ae({name:Jt,props:qt,emits:["close"],setup(A,{slots:U,emit:F}){const J=T=>{T.stopPropagation(),F("close",T)},P=()=>A.plain?{color:A.textColor||A.color,borderColor:A.color}:{color:A.textColor,background:A.color},Y=()=>{var T;const{type:S,mark:p,plain:E,round:h,size:u,closeable:s}=A,f={mark:p,plain:E,round:h};u&&(f[u]=u);const n=s&&Q(De,{name:"cross",class:[$e("close"),Rt],onClick:J},null);return Q("span",{style:P(),class:$e([f,S])},[(T=U.default)==null?void 0:T.call(U),n])};return()=>Q(At,{name:A.closeable?"van-fade":void 0},{default:()=>[A.show?Y():null]})}});const tr=Fe(er),[rr,nr]=Be("divider"),ir={dashed:Boolean,hairline:we,vertical:Boolean,contentPosition:be("center")};var sr=Ae({name:rr,props:ir,setup(A,{slots:U}){return()=>{var F;return Q("div",{role:"separator",class:nr({dashed:A.dashed,hairline:A.hairline,vertical:A.vertical,[`content-${A.contentPosition}`]:!!U.default&&!A.vertical})},[!A.vertical&&((F=U.default)==null?void 0:F.call(U))])}}});const ar=Fe(sr);var rt={exports:{}};(function(A,U){(function(J,P){A.exports=P()})(self,function(){return function(){var F={"./node_modules/es6-promise/dist/es6-promise.js":function(T,S,p){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(E,h){T.exports=h()})(this,function(){function E(R){var I=typeof R;return R!==null&&(I==="object"||I==="function")}function h(R){return typeof R=="function"}var u=void 0;Array.isArray?u=Array.isArray:u=function(R){return Object.prototype.toString.call(R)==="[object Array]"};var s=u,f=0,n=void 0,l=void 0,o=function(I,D){g[f]=I,g[f+1]=D,f+=2,f===2&&(l?l(b):O())};function r(R){l=R}function t(R){o=R}var a=typeof window<"u"?window:void 0,i=a||{},e=i.MutationObserver||i.WebKitMutationObserver,d=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",c=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function _(){return function(){return process.nextTick(b)}}function v(){return typeof n<"u"?function(){n(b)}:m()}function y(){var R=0,I=new e(b),D=document.createTextNode("");return I.observe(D,{characterData:!0}),function(){D.data=R=++R%2}}function x(){var R=new MessageChannel;return R.port1.onmessage=b,function(){return R.port2.postMessage(0)}}function m(){var R=setTimeout;return function(){return R(b,1)}}var g=new Array(1e3);function b(){for(var R=0;R<f;R+=2){var I=g[R],D=g[R+1];I(D),g[R]=void 0,g[R+1]=void 0}f=0}function C(){try{var R=Function("return this")().require("vertx");return n=R.runOnLoop||R.runOnContext,v()}catch{return m()}}var O=void 0;d?O=_():e?O=y():c?O=x():a===void 0?O=C():O=m();function M(R,I){var D=this,B=new this.constructor(V);B[W]===void 0&&xe(B);var K=D._state;if(K){var H=arguments[K-1];o(function(){return ve(K,B,H,D._result)})}else re(D,B,R,I);return B}function G(R){var I=this;if(R&&typeof R=="object"&&R.constructor===I)return R;var D=new I(V);return $(D,R),D}var W=Math.random().toString(36).substring(2);function V(){}var X=void 0,te=1,N=2;function Z(){return new TypeError("You cannot resolve a promise with itself")}function ae(){return new TypeError("A promises callback cannot return that same promise.")}function q(R,I,D,B){try{R.call(I,D,B)}catch(K){return K}}function L(R,I,D){o(function(B){var K=!1,H=q(D,I,function(ne){K||(K=!0,I!==ne?$(B,ne):z(B,ne))},function(ne){K||(K=!0,w(B,ne))},"Settle: "+(B._label||" unknown promise"));!K&&H&&(K=!0,w(B,H))},R)}function j(R,I){I._state===te?z(R,I._result):I._state===N?w(R,I._result):re(I,void 0,function(D){return $(R,D)},function(D){return w(R,D)})}function k(R,I,D){I.constructor===R.constructor&&D===M&&I.constructor.resolve===G?j(R,I):D===void 0?z(R,I):h(D)?L(R,I,D):z(R,I)}function $(R,I){if(R===I)w(R,Z());else if(E(I)){var D=void 0;try{D=I.then}catch(B){w(R,B);return}k(R,I,D)}else z(R,I)}function ee(R){R._onerror&&R._onerror(R._result),se(R)}function z(R,I){R._state===X&&(R._result=I,R._state=te,R._subscribers.length!==0&&o(se,R))}function w(R,I){R._state===X&&(R._state=N,R._result=I,o(ee,R))}function re(R,I,D,B){var K=R._subscribers,H=K.length;R._onerror=null,K[H]=I,K[H+te]=D,K[H+N]=B,H===0&&R._state&&o(se,R)}function se(R){var I=R._subscribers,D=R._state;if(I.length!==0){for(var B=void 0,K=void 0,H=R._result,ne=0;ne<I.length;ne+=3)B=I[ne],K=I[ne+D],B?ve(D,B,K,H):K(H);R._subscribers.length=0}}function ve(R,I,D,B){var K=h(D),H=void 0,ne=void 0,Ee=!0;if(K){try{H=D(B)}catch(Ce){Ee=!1,ne=Ce}if(I===H){w(I,ae());return}}else H=B;I._state!==X||(K&&Ee?$(I,H):Ee===!1?w(I,ne):R===te?z(I,H):R===N&&w(I,H))}function fe(R,I){try{I(function(B){$(R,B)},function(B){w(R,B)})}catch(D){w(R,D)}}var pe=0;function ge(){return pe++}function xe(R){R[W]=pe++,R._state=void 0,R._result=void 0,R._subscribers=[]}function de(){return new Error("Array Methods must be provided an Array")}var oe=function(){function R(I,D){this._instanceConstructor=I,this.promise=new I(V),this.promise[W]||xe(this.promise),s(D)?(this.length=D.length,this._remaining=D.length,this._result=new Array(this.length),this.length===0?z(this.promise,this._result):(this.length=this.length||0,this._enumerate(D),this._remaining===0&&z(this.promise,this._result))):w(this.promise,de())}return R.prototype._enumerate=function(D){for(var B=0;this._state===X&&B<D.length;B++)this._eachEntry(D[B],B)},R.prototype._eachEntry=function(D,B){var K=this._instanceConstructor,H=K.resolve;if(H===G){var ne=void 0,Ee=void 0,Ce=!1;try{ne=D.then}catch(Ue){Ce=!0,Ee=Ue}if(ne===M&&D._state!==X)this._settledAt(D._state,B,D._result);else if(typeof ne!="function")this._remaining--,this._result[B]=D;else if(K===ie){var ke=new K(V);Ce?w(ke,Ee):k(ke,D,ne),this._willSettleAt(ke,B)}else this._willSettleAt(new K(function(Ue){return Ue(D)}),B)}else this._willSettleAt(H(D),B)},R.prototype._settledAt=function(D,B,K){var H=this.promise;H._state===X&&(this._remaining--,D===N?w(H,K):this._result[B]=K),this._remaining===0&&z(H,this._result)},R.prototype._willSettleAt=function(D,B){var K=this;re(D,void 0,function(H){return K._settledAt(te,B,H)},function(H){return K._settledAt(N,B,H)})},R}();function Re(R){return new oe(this,R).promise}function Oe(R){var I=this;return s(R)?new I(function(D,B){for(var K=R.length,H=0;H<K;H++)I.resolve(R[H]).then(D,B)}):new I(function(D,B){return B(new TypeError("You must pass an array to race."))})}function nt(R){var I=this,D=new I(V);return w(D,R),D}function it(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function st(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var ie=function(){function R(I){this[W]=ge(),this._result=this._state=void 0,this._subscribers=[],V!==I&&(typeof I!="function"&&it(),this instanceof R?fe(this,I):st())}return R.prototype.catch=function(D){return this.then(null,D)},R.prototype.finally=function(D){var B=this,K=B.constructor;return h(D)?B.then(function(H){return K.resolve(D()).then(function(){return H})},function(H){return K.resolve(D()).then(function(){throw H})}):B.then(D,D)},R}();ie.prototype.then=M,ie.all=Re,ie.race=Oe,ie.resolve=G,ie.reject=nt,ie._setScheduler=r,ie._setAsap=t,ie._asap=o;function at(){var R=void 0;if(typeof p.g<"u")R=p.g;else if(typeof self<"u")R=self;else try{R=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var I=R.Promise;if(I){var D=null;try{D=Object.prototype.toString.call(I.resolve())}catch{}if(D==="[object Promise]"&&!I.cast)return}R.Promise=ie}return ie.polyfill=at,ie.Promise=ie,ie})},"./node_modules/events/events.js":function(T){var S=typeof Reflect=="object"?Reflect:null,p=S&&typeof S.apply=="function"?S.apply:function(m,g,b){return Function.prototype.apply.call(m,g,b)},E;S&&typeof S.ownKeys=="function"?E=S.ownKeys:Object.getOwnPropertySymbols?E=function(m){return Object.getOwnPropertyNames(m).concat(Object.getOwnPropertySymbols(m))}:E=function(m){return Object.getOwnPropertyNames(m)};function h(x){console&&console.warn&&console.warn(x)}var u=Number.isNaN||function(m){return m!==m};function s(){s.init.call(this)}T.exports=s,T.exports.once=_,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var f=10;function n(x){if(typeof x!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof x)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(x){if(typeof x!="number"||x<0||u(x))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+x+".");f=x}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(m){if(typeof m!="number"||m<0||u(m))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+m+".");return this._maxListeners=m,this};function l(x){return x._maxListeners===void 0?s.defaultMaxListeners:x._maxListeners}s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(m){for(var g=[],b=1;b<arguments.length;b++)g.push(arguments[b]);var C=m==="error",O=this._events;if(O!==void 0)C=C&&O.error===void 0;else if(!C)return!1;if(C){var M;if(g.length>0&&(M=g[0]),M instanceof Error)throw M;var G=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw G.context=M,G}var W=O[m];if(W===void 0)return!1;if(typeof W=="function")p(W,this,g);else for(var V=W.length,X=e(W,V),b=0;b<V;++b)p(X[b],this,g);return!0};function o(x,m,g,b){var C,O,M;if(n(g),O=x._events,O===void 0?(O=x._events=Object.create(null),x._eventsCount=0):(O.newListener!==void 0&&(x.emit("newListener",m,g.listener?g.listener:g),O=x._events),M=O[m]),M===void 0)M=O[m]=g,++x._eventsCount;else if(typeof M=="function"?M=O[m]=b?[g,M]:[M,g]:b?M.unshift(g):M.push(g),C=l(x),C>0&&M.length>C&&!M.warned){M.warned=!0;var G=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(m)+" listeners added. Use emitter.setMaxListeners() to increase limit");G.name="MaxListenersExceededWarning",G.emitter=x,G.type=m,G.count=M.length,h(G)}return x}s.prototype.addListener=function(m,g){return o(this,m,g,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(m,g){return o(this,m,g,!0)};function r(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function t(x,m,g){var b={fired:!1,wrapFn:void 0,target:x,type:m,listener:g},C=r.bind(b);return C.listener=g,b.wrapFn=C,C}s.prototype.once=function(m,g){return n(g),this.on(m,t(this,m,g)),this},s.prototype.prependOnceListener=function(m,g){return n(g),this.prependListener(m,t(this,m,g)),this},s.prototype.removeListener=function(m,g){var b,C,O,M,G;if(n(g),C=this._events,C===void 0)return this;if(b=C[m],b===void 0)return this;if(b===g||b.listener===g)--this._eventsCount===0?this._events=Object.create(null):(delete C[m],C.removeListener&&this.emit("removeListener",m,b.listener||g));else if(typeof b!="function"){for(O=-1,M=b.length-1;M>=0;M--)if(b[M]===g||b[M].listener===g){G=b[M].listener,O=M;break}if(O<0)return this;O===0?b.shift():d(b,O),b.length===1&&(C[m]=b[0]),C.removeListener!==void 0&&this.emit("removeListener",m,G||g)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(m){var g,b,C;if(b=this._events,b===void 0)return this;if(b.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):b[m]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete b[m]),this;if(arguments.length===0){var O=Object.keys(b),M;for(C=0;C<O.length;++C)M=O[C],M!=="removeListener"&&this.removeAllListeners(M);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(g=b[m],typeof g=="function")this.removeListener(m,g);else if(g!==void 0)for(C=g.length-1;C>=0;C--)this.removeListener(m,g[C]);return this};function a(x,m,g){var b=x._events;if(b===void 0)return[];var C=b[m];return C===void 0?[]:typeof C=="function"?g?[C.listener||C]:[C]:g?c(C):e(C,C.length)}s.prototype.listeners=function(m){return a(this,m,!0)},s.prototype.rawListeners=function(m){return a(this,m,!1)},s.listenerCount=function(x,m){return typeof x.listenerCount=="function"?x.listenerCount(m):i.call(x,m)},s.prototype.listenerCount=i;function i(x){var m=this._events;if(m!==void 0){var g=m[x];if(typeof g=="function")return 1;if(g!==void 0)return g.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?E(this._events):[]};function e(x,m){for(var g=new Array(m),b=0;b<m;++b)g[b]=x[b];return g}function d(x,m){for(;m+1<x.length;m++)x[m]=x[m+1];x.pop()}function c(x){for(var m=new Array(x.length),g=0;g<m.length;++g)m[g]=x[g].listener||x[g];return m}function _(x,m){return new Promise(function(g,b){function C(M){x.removeListener(m,O),b(M)}function O(){typeof x.removeListener=="function"&&x.removeListener("error",C),g([].slice.call(arguments))}y(x,m,O,{once:!0}),m!=="error"&&v(x,C,{once:!0})})}function v(x,m,g){typeof x.on=="function"&&y(x,"error",m,g)}function y(x,m,g,b){if(typeof x.on=="function")b.once?x.once(m,g):x.on(m,g);else if(typeof x.addEventListener=="function")x.addEventListener(m,function C(O){b.once&&x.removeEventListener(m,C),g(O)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof x)}},"./node_modules/webworkify-webpack/index.js":function(T,S,p){function E(r){var t={};function a(e){if(t[e])return t[e].exports;var d=t[e]={i:e,l:!1,exports:{}};return r[e].call(d.exports,d,d.exports,a),d.l=!0,d.exports}a.m=r,a.c=t,a.i=function(e){return e},a.d=function(e,d,c){a.o(e,d)||Object.defineProperty(e,d,{configurable:!1,enumerable:!0,get:c})},a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},a.n=function(e){var d=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(d,"a",d),d},a.o=function(e,d){return Object.prototype.hasOwnProperty.call(e,d)},a.p="/",a.oe=function(e){throw console.error(e),e};var i=a(a.s=ENTRY_MODULE);return i.default||i}var h="[\\.|\\-|\\+|\\w|/|@]+",u="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+h+").*?\\)";function s(r){return(r+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function f(r){return!isNaN(1*r)}function n(r,t,a){var i={};i[a]=[];var e=t.toString(),d=e.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!d)return i;for(var c=d[1],_=new RegExp("(\\\\n|\\W)"+s(c)+u,"g"),v;v=_.exec(e);)v[3]!=="dll-reference"&&i[a].push(v[3]);for(_=new RegExp("\\("+s(c)+'\\("(dll-reference\\s('+h+'))"\\)\\)'+u,"g");v=_.exec(e);)r[v[2]]||(i[a].push(v[1]),r[v[2]]=p(v[1]).m),i[v[2]]=i[v[2]]||[],i[v[2]].push(v[4]);for(var y=Object.keys(i),x=0;x<y.length;x++)for(var m=0;m<i[y[x]].length;m++)f(i[y[x]][m])&&(i[y[x]][m]=1*i[y[x]][m]);return i}function l(r){var t=Object.keys(r);return t.reduce(function(a,i){return a||r[i].length>0},!1)}function o(r,t){for(var a={main:[t]},i={main:[]},e={main:{}};l(a);)for(var d=Object.keys(a),c=0;c<d.length;c++){var _=d[c],v=a[_],y=v.pop();if(e[_]=e[_]||{},!(e[_][y]||!r[_][y])){e[_][y]=!0,i[_]=i[_]||[],i[_].push(y);for(var x=n(r,r[_][y],_),m=Object.keys(x),g=0;g<m.length;g++)a[m[g]]=a[m[g]]||[],a[m[g]]=a[m[g]].concat(x[m[g]])}}return i}T.exports=function(r,t){t=t||{};var a={main:p.m},i=t.all?{main:Object.keys(a.main)}:o(a,r),e="";Object.keys(i).filter(function(y){return y!=="main"}).forEach(function(y){for(var x=0;i[y][x];)x++;i[y].push(x),a[y][x]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",e=e+"var "+y+" = ("+E.toString().replace("ENTRY_MODULE",JSON.stringify(x))+")({"+i[y].map(function(m){return""+JSON.stringify(m)+": "+a[y][m].toString()}).join(",")+`});
`}),e=e+"new (("+E.toString().replace("ENTRY_MODULE",JSON.stringify(r))+")({"+i.main.map(function(y){return""+JSON.stringify(y)+": "+a.main[y].toString()}).join(",")+"}))(self);";var d=new window.Blob([e],{type:"text/javascript"});if(t.bare)return d;var c=window.URL||window.webkitURL||window.mozURL||window.msURL,_=c.createObjectURL(d),v=new window.Worker(_);return v.objectURL=_,v}},"./src/config.js":function(T,S,p){p.r(S),p.d(S,{defaultConfig:function(){return E},createDefaultConfig:function(){return h}});var E={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function h(){return Object.assign({},E)}},"./src/core/features.js":function(T,S,p){p.r(S);var E=p("./src/io/io-controller.js"),h=p("./src/config.js"),u=function(){function s(){}return s.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},s.supportNetworkStreamIO=function(){var f=new E.default({},(0,h.createDefaultConfig)()),n=f.loaderType;return f.destroy(),n=="fetch-stream-loader"||n=="xhr-moz-chunked-loader"},s.getNetworkLoaderTypeName=function(){var f=new E.default({},(0,h.createDefaultConfig)()),n=f.loaderType;return f.destroy(),n},s.supportNativeMediaPlayback=function(f){s.videoElement==null&&(s.videoElement=window.document.createElement("video"));var n=s.videoElement.canPlayType(f);return n==="probably"||n=="maybe"},s.getFeatureList=function(){var f={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return f.mseFlvPlayback=s.supportMSEH264Playback(),f.networkStreamIO=s.supportNetworkStreamIO(),f.networkLoaderName=s.getNetworkLoaderTypeName(),f.mseLiveFlvPlayback=f.mseFlvPlayback&&f.networkStreamIO,f.nativeMP4H264Playback=s.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),f.nativeWebmVP8Playback=s.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),f.nativeWebmVP9Playback=s.supportNativeMediaPlayback('video/webm; codecs="vp9"'),f},s}();S.default=u},"./src/core/media-info.js":function(T,S,p){p.r(S);var E=function(){function h(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return h.prototype.isComplete=function(){var u=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,s=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&u&&s},h.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},h.prototype.getNearestKeyframe=function(u){if(this.keyframesIndex==null)return null;var s=this.keyframesIndex,f=this._search(s.times,u);return{index:f,milliseconds:s.times[f],fileposition:s.filepositions[f]}},h.prototype._search=function(u,s){var f=0,n=u.length-1,l=0,o=0,r=n;for(s<u[0]&&(f=0,o=r+1);o<=r;)if(l=o+Math.floor((r-o)/2),l===n||s>=u[l]&&s<u[l+1]){f=l;break}else u[l]<s?o=l+1:r=l-1;return f},h}();S.default=E},"./src/core/media-segment-info.js":function(T,S,p){p.r(S),p.d(S,{SampleInfo:function(){return E},MediaSegmentInfo:function(){return h},IDRSampleList:function(){return u},MediaSegmentInfoList:function(){return s}});var E=function(){function f(n,l,o,r,t){this.dts=n,this.pts=l,this.duration=o,this.originalDts=r,this.isSyncPoint=t,this.fileposition=null}return f}(),h=function(){function f(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return f.prototype.appendSyncPoint=function(n){n.isSyncPoint=!0,this.syncPoints.push(n)},f}(),u=function(){function f(){this._list=[]}return f.prototype.clear=function(){this._list=[]},f.prototype.appendArray=function(n){var l=this._list;n.length!==0&&(l.length>0&&n[0].originalDts<l[l.length-1].originalDts&&this.clear(),Array.prototype.push.apply(l,n))},f.prototype.getLastSyncPointBeforeDts=function(n){if(this._list.length==0)return null;var l=this._list,o=0,r=l.length-1,t=0,a=0,i=r;for(n<l[0].dts&&(o=0,a=i+1);a<=i;)if(t=a+Math.floor((i-a)/2),t===r||n>=l[t].dts&&n<l[t+1].dts){o=t;break}else l[t].dts<n?a=t+1:i=t-1;return this._list[o]},f}(),s=function(){function f(n){this._type=n,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(f.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),f.prototype.isEmpty=function(){return this._list.length===0},f.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},f.prototype._searchNearestSegmentBefore=function(n){var l=this._list;if(l.length===0)return-2;var o=l.length-1,r=0,t=0,a=o,i=0;if(n<l[0].originalBeginDts)return i=-1,i;for(;t<=a;)if(r=t+Math.floor((a-t)/2),r===o||n>l[r].lastSample.originalDts&&n<l[r+1].originalBeginDts){i=r;break}else l[r].originalBeginDts<n?t=r+1:a=r-1;return i},f.prototype._searchNearestSegmentAfter=function(n){return this._searchNearestSegmentBefore(n)+1},f.prototype.append=function(n){var l=this._list,o=n,r=this._lastAppendLocation,t=0;r!==-1&&r<l.length&&o.originalBeginDts>=l[r].lastSample.originalDts&&(r===l.length-1||r<l.length-1&&o.originalBeginDts<l[r+1].originalBeginDts)?t=r+1:l.length>0&&(t=this._searchNearestSegmentBefore(o.originalBeginDts)+1),this._lastAppendLocation=t,this._list.splice(t,0,o)},f.prototype.getLastSegmentBefore=function(n){var l=this._searchNearestSegmentBefore(n);return l>=0?this._list[l]:null},f.prototype.getLastSampleBefore=function(n){var l=this.getLastSegmentBefore(n);return l!=null?l.lastSample:null},f.prototype.getLastSyncPointBefore=function(n){for(var l=this._searchNearestSegmentBefore(n),o=this._list[l].syncPoints;o.length===0&&l>0;)l--,o=this._list[l].syncPoints;return o.length>0?o[o.length-1]:null},f}()},"./src/core/mse-controller.js":function(T,S,p){p.r(S);var E=p("./node_modules/events/events.js"),h=p.n(E),u=p("./src/utils/logger.js"),s=p("./src/utils/browser.js"),f=p("./src/core/mse-events.js"),n=p("./src/core/media-segment-info.js"),l=p("./src/utils/exception.js"),o=function(){function r(t){this.TAG="MSEController",this._config=t,this._emitter=new(h()),this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new n.IDRSampleList}return r.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},r.prototype.on=function(t,a){this._emitter.addListener(t,a)},r.prototype.off=function(t,a){this._emitter.removeListener(t,a)},r.prototype.attachMediaElement=function(t){if(this._mediaSource)throw new l.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var a=this._mediaSource=new window.MediaSource;a.addEventListener("sourceopen",this.e.onSourceOpen),a.addEventListener("sourceended",this.e.onSourceEnded),a.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=t,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),t.src=this._mediaSourceObjectURL},r.prototype.detachMediaElement=function(){if(this._mediaSource){var t=this._mediaSource;for(var a in this._sourceBuffers){var i=this._pendingSegments[a];i.splice(0,i.length),this._pendingSegments[a]=null,this._pendingRemoveRanges[a]=null,this._lastInitSegments[a]=null;var e=this._sourceBuffers[a];if(e){if(t.readyState!=="closed"){try{t.removeSourceBuffer(e)}catch(d){u.default.e(this.TAG,d.message)}e.removeEventListener("error",this.e.onSourceBufferError),e.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[a]=null,this._sourceBuffers[a]=null}}if(t.readyState==="open")try{t.endOfStream()}catch(d){u.default.e(this.TAG,d.message)}t.removeEventListener("sourceopen",this.e.onSourceOpen),t.removeEventListener("sourceended",this.e.onSourceEnded),t.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},r.prototype.appendInitSegment=function(t,a){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(t),this._pendingSegments[t.type].push(t);return}var i=t,e=""+i.container;i.codec&&i.codec.length>0&&(e+=";codecs="+i.codec);var d=!1;if(u.default.v(this.TAG,"Received Initialization Segment, mimeType: "+e),this._lastInitSegments[i.type]=i,e!==this._mimeTypes[i.type]){if(this._mimeTypes[i.type])u.default.v(this.TAG,"Notice: "+i.type+" mimeType changed, origin: "+this._mimeTypes[i.type]+", target: "+e);else{d=!0;try{var c=this._sourceBuffers[i.type]=this._mediaSource.addSourceBuffer(e);c.addEventListener("error",this.e.onSourceBufferError),c.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(_){u.default.e(this.TAG,_.message),this._emitter.emit(f.default.ERROR,{code:_.code,msg:_.message});return}}this._mimeTypes[i.type]=e}a||this._pendingSegments[i.type].push(i),d||this._sourceBuffers[i.type]&&!this._sourceBuffers[i.type].updating&&this._doAppendSegments(),s.default.safari&&i.container==="audio/mpeg"&&i.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=i.mediaDuration/1e3,this._updateMediaSourceDuration())},r.prototype.appendMediaSegment=function(t){var a=t;this._pendingSegments[a.type].push(a),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var i=this._sourceBuffers[a.type];i&&!i.updating&&!this._hasPendingRemoveRanges()&&this._doAppendSegments()},r.prototype.seek=function(t){for(var a in this._sourceBuffers)if(this._sourceBuffers[a]){var i=this._sourceBuffers[a];if(this._mediaSource.readyState==="open")try{i.abort()}catch(y){u.default.e(this.TAG,y.message)}this._idrList.clear();var e=this._pendingSegments[a];if(e.splice(0,e.length),this._mediaSource.readyState!=="closed"){for(var d=0;d<i.buffered.length;d++){var c=i.buffered.start(d),_=i.buffered.end(d);this._pendingRemoveRanges[a].push({start:c,end:_})}if(i.updating||this._doRemoveRanges(),s.default.safari){var v=this._lastInitSegments[a];v&&(this._pendingSegments[a].push(v),i.updating||this._doAppendSegments())}}}},r.prototype.endOfStream=function(){var t=this._mediaSource,a=this._sourceBuffers;if(!t||t.readyState!=="open"){t&&t.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}a.video&&a.video.updating||a.audio&&a.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,t.endOfStream())},r.prototype.getNearestKeyframe=function(t){return this._idrList.getLastSyncPointBeforeDts(t)},r.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var t=this._mediaElement.currentTime;for(var a in this._sourceBuffers){var i=this._sourceBuffers[a];if(i){var e=i.buffered;if(e.length>=1&&t-e.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},r.prototype._doCleanupSourceBuffer=function(){var t=this._mediaElement.currentTime;for(var a in this._sourceBuffers){var i=this._sourceBuffers[a];if(i){for(var e=i.buffered,d=!1,c=0;c<e.length;c++){var _=e.start(c),v=e.end(c);if(_<=t&&t<v+3){if(t-_>=this._config.autoCleanupMaxBackwardDuration){d=!0;var y=t-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[a].push({start:_,end:y})}}else v<t&&(d=!0,this._pendingRemoveRanges[a].push({start:_,end:v}))}d&&!i.updating&&this._doRemoveRanges()}}},r.prototype._updateMediaSourceDuration=function(){var t=this._sourceBuffers;if(!(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open")&&!(t.video&&t.video.updating||t.audio&&t.audio.updating)){var a=this._mediaSource.duration,i=this._pendingMediaDuration;i>0&&(isNaN(a)||i>a)&&(u.default.v(this.TAG,"Update MediaSource duration from "+a+" to "+i),this._mediaSource.duration=i),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},r.prototype._doRemoveRanges=function(){for(var t in this._pendingRemoveRanges)if(!(!this._sourceBuffers[t]||this._sourceBuffers[t].updating))for(var a=this._sourceBuffers[t],i=this._pendingRemoveRanges[t];i.length&&!a.updating;){var e=i.shift();a.remove(e.start,e.end)}},r.prototype._doAppendSegments=function(){var t=this._pendingSegments;for(var a in t)if(!(!this._sourceBuffers[a]||this._sourceBuffers[a].updating)&&t[a].length>0){var i=t[a].shift();if(i.timestampOffset){var e=this._sourceBuffers[a].timestampOffset,d=i.timestampOffset/1e3,c=Math.abs(e-d);c>.1&&(u.default.v(this.TAG,"Update MPEG audio timestampOffset from "+e+" to "+d),this._sourceBuffers[a].timestampOffset=d),delete i.timestampOffset}if(!i.data||i.data.byteLength===0)continue;try{this._sourceBuffers[a].appendBuffer(i.data),this._isBufferFull=!1,a==="video"&&i.hasOwnProperty("info")&&this._idrList.appendArray(i.info.syncPoints)}catch(_){this._pendingSegments[a].unshift(i),_.code===22?(this._isBufferFull||this._emitter.emit(f.default.BUFFER_FULL),this._isBufferFull=!0):(u.default.e(this.TAG,_.message),this._emitter.emit(f.default.ERROR,{code:_.code,msg:_.message}))}}},r.prototype._onSourceOpen=function(){if(u.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var t=this._pendingSourceBufferInit;t.length;){var a=t.shift();this.appendInitSegment(a,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(f.default.SOURCE_OPEN)},r.prototype._onSourceEnded=function(){u.default.v(this.TAG,"MediaSource onSourceEnded")},r.prototype._onSourceClose=function(){u.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},r.prototype._hasPendingSegments=function(){var t=this._pendingSegments;return t.video.length>0||t.audio.length>0},r.prototype._hasPendingRemoveRanges=function(){var t=this._pendingRemoveRanges;return t.video.length>0||t.audio.length>0},r.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(f.default.UPDATE_END)},r.prototype._onSourceBufferError=function(t){u.default.e(this.TAG,"SourceBuffer Error: "+t)},r}();S.default=o},"./src/core/mse-events.js":function(T,S,p){p.r(S);var E={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};S.default=E},"./src/core/transmuxer.js":function(T,S,p){p.r(S);var E=p("./node_modules/events/events.js"),h=p.n(E),u=p("./node_modules/webworkify-webpack/index.js"),s=p.n(u),f=p("./src/utils/logger.js"),n=p("./src/utils/logging-control.js"),l=p("./src/core/transmuxing-controller.js"),o=p("./src/core/transmuxing-events.js"),r=p("./src/core/media-info.js"),t=function(){function a(i,e){if(this.TAG="Transmuxer",this._emitter=new(h()),e.enableWorker&&typeof Worker<"u")try{this._worker=s()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[i,e]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},n.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:n.default.getConfig()})}catch{f.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new l.default(i,e)}else this._controller=new l.default(i,e);if(this._controller){var d=this._controller;d.on(o.default.IO_ERROR,this._onIOError.bind(this)),d.on(o.default.DEMUX_ERROR,this._onDemuxError.bind(this)),d.on(o.default.INIT_SEGMENT,this._onInitSegment.bind(this)),d.on(o.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),d.on(o.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),d.on(o.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),d.on(o.default.MEDIA_INFO,this._onMediaInfo.bind(this)),d.on(o.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),d.on(o.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),d.on(o.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),d.on(o.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return a.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),n.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},a.prototype.on=function(i,e){this._emitter.addListener(i,e)},a.prototype.off=function(i,e){this._emitter.removeListener(i,e)},a.prototype.hasWorker=function(){return this._worker!=null},a.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},a.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},a.prototype.seek=function(i){this._worker?this._worker.postMessage({cmd:"seek",param:i}):this._controller.seek(i)},a.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},a.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},a.prototype._onInitSegment=function(i,e){var d=this;Promise.resolve().then(function(){d._emitter.emit(o.default.INIT_SEGMENT,i,e)})},a.prototype._onMediaSegment=function(i,e){var d=this;Promise.resolve().then(function(){d._emitter.emit(o.default.MEDIA_SEGMENT,i,e)})},a.prototype._onLoadingComplete=function(){var i=this;Promise.resolve().then(function(){i._emitter.emit(o.default.LOADING_COMPLETE)})},a.prototype._onRecoveredEarlyEof=function(){var i=this;Promise.resolve().then(function(){i._emitter.emit(o.default.RECOVERED_EARLY_EOF)})},a.prototype._onMediaInfo=function(i){var e=this;Promise.resolve().then(function(){e._emitter.emit(o.default.MEDIA_INFO,i)})},a.prototype._onMetaDataArrived=function(i){var e=this;Promise.resolve().then(function(){e._emitter.emit(o.default.METADATA_ARRIVED,i)})},a.prototype._onScriptDataArrived=function(i){var e=this;Promise.resolve().then(function(){e._emitter.emit(o.default.SCRIPTDATA_ARRIVED,i)})},a.prototype._onStatisticsInfo=function(i){var e=this;Promise.resolve().then(function(){e._emitter.emit(o.default.STATISTICS_INFO,i)})},a.prototype._onIOError=function(i,e){var d=this;Promise.resolve().then(function(){d._emitter.emit(o.default.IO_ERROR,i,e)})},a.prototype._onDemuxError=function(i,e){var d=this;Promise.resolve().then(function(){d._emitter.emit(o.default.DEMUX_ERROR,i,e)})},a.prototype._onRecommendSeekpoint=function(i){var e=this;Promise.resolve().then(function(){e._emitter.emit(o.default.RECOMMEND_SEEKPOINT,i)})},a.prototype._onLoggingConfigChanged=function(i){this._worker&&this._worker.postMessage({cmd:"logging_config",param:i})},a.prototype._onWorkerMessage=function(i){var e=i.data,d=e.data;if(e.msg==="destroyed"||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(e.msg){case o.default.INIT_SEGMENT:case o.default.MEDIA_SEGMENT:this._emitter.emit(e.msg,d.type,d.data);break;case o.default.LOADING_COMPLETE:case o.default.RECOVERED_EARLY_EOF:this._emitter.emit(e.msg);break;case o.default.MEDIA_INFO:Object.setPrototypeOf(d,r.default.prototype),this._emitter.emit(e.msg,d);break;case o.default.METADATA_ARRIVED:case o.default.SCRIPTDATA_ARRIVED:case o.default.STATISTICS_INFO:this._emitter.emit(e.msg,d);break;case o.default.IO_ERROR:case o.default.DEMUX_ERROR:this._emitter.emit(e.msg,d.type,d.info);break;case o.default.RECOMMEND_SEEKPOINT:this._emitter.emit(e.msg,d);break;case"logcat_callback":f.default.emitter.emit("log",d.type,d.logcat);break}},a}();S.default=t},"./src/core/transmuxing-controller.js":function(T,S,p){p.r(S);var E=p("./node_modules/events/events.js"),h=p.n(E),u=p("./src/utils/logger.js"),s=p("./src/utils/browser.js"),f=p("./src/core/media-info.js"),n=p("./src/demux/flv-demuxer.js"),l=p("./src/remux/mp4-remuxer.js"),o=p("./src/demux/demux-errors.js"),r=p("./src/io/io-controller.js"),t=p("./src/core/transmuxing-events.js"),a=function(){function i(e,d){this.TAG="TransmuxingController",this._emitter=new(h()),this._config=d,e.segments||(e.segments=[{duration:e.duration,filesize:e.filesize,url:e.url}]),typeof e.cors!="boolean"&&(e.cors=!0),typeof e.withCredentials!="boolean"&&(e.withCredentials=!1),this._mediaDataSource=e,this._currentSegmentIndex=0;var c=0;this._mediaDataSource.segments.forEach(function(_){_.timestampBase=c,c+=_.duration,_.cors=e.cors,_.withCredentials=e.withCredentials,d.referrerPolicy&&(_.referrerPolicy=d.referrerPolicy)}),!isNaN(c)&&this._mediaDataSource.duration!==c&&(this._mediaDataSource.duration=c),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return i.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},i.prototype.on=function(e,d){this._emitter.addListener(e,d)},i.prototype.off=function(e,d){this._emitter.removeListener(e,d)},i.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},i.prototype._loadSegment=function(e,d){this._currentSegmentIndex=e;var c=this._mediaDataSource.segments[e],_=this._ioctl=new r.default(c,this._config,e);_.onError=this._onIOException.bind(this),_.onSeeked=this._onIOSeeked.bind(this),_.onComplete=this._onIOComplete.bind(this),_.onRedirect=this._onIORedirect.bind(this),_.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),d?this._demuxer.bindDataSource(this._ioctl):_.onDataArrival=this._onInitChunkArrival.bind(this),_.open(d)},i.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},i.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},i.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},i.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},i.prototype.seek=function(e){if(!(this._mediaInfo==null||!this._mediaInfo.isSeekable())){var d=this._searchSegmentIndexContains(e);if(d===this._currentSegmentIndex){var c=this._mediaInfo.segments[d];if(c==null)this._pendingSeekTime=e;else{var _=c.getNearestKeyframe(e);this._remuxer.seek(_.milliseconds),this._ioctl.seek(_.fileposition),this._pendingResolveSeekPoint=_.milliseconds}}else{var v=this._mediaInfo.segments[d];if(v==null)this._pendingSeekTime=e,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(d);else{var _=v.getNearestKeyframe(e);this._internalAbort(),this._remuxer.seek(e),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[d].timestampBase,this._loadSegment(d,_.fileposition),this._pendingResolveSeekPoint=_.milliseconds,this._reportSegmentMediaInfo(d)}}this._enableStatisticsReporter()}},i.prototype._searchSegmentIndexContains=function(e){for(var d=this._mediaDataSource.segments,c=d.length-1,_=0;_<d.length;_++)if(e<d[_].timestampBase){c=_-1;break}return c},i.prototype._onInitChunkArrival=function(e,d){var c=this,_=null,v=0;if(d>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,v=this._demuxer.parseChunks(e,d);else if((_=n.default.probe(e)).match){this._demuxer=new n.default(_,this._config),this._remuxer||(this._remuxer=new l.default(this._config));var y=this._mediaDataSource;y.duration!=null&&!isNaN(y.duration)&&(this._demuxer.overridedDuration=y.duration),typeof y.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=y.hasAudio),typeof y.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=y.hasVideo),this._demuxer.timestampBase=y.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),v=this._demuxer.parseChunks(e,d)}else _=null,u.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){c._internalAbort()}),this._emitter.emit(t.default.DEMUX_ERROR,o.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),v=0;return v},i.prototype._onMediaInfo=function(e){var d=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},e),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,f.default.prototype));var c=Object.assign({},e);Object.setPrototypeOf(c,f.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=c,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var _=d._pendingSeekTime;d._pendingSeekTime=null,d.seek(_)})},i.prototype._onMetaDataArrived=function(e){this._emitter.emit(t.default.METADATA_ARRIVED,e)},i.prototype._onScriptDataArrived=function(e){this._emitter.emit(t.default.SCRIPTDATA_ARRIVED,e)},i.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},i.prototype._onIOComplete=function(e){var d=e,c=d+1;c<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(c)):(this._remuxer.flushStashedSamples(),this._emitter.emit(t.default.LOADING_COMPLETE),this._disableStatisticsReporter())},i.prototype._onIORedirect=function(e){var d=this._ioctl.extraData;this._mediaDataSource.segments[d].redirectedURL=e},i.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(t.default.RECOVERED_EARLY_EOF)},i.prototype._onIOException=function(e,d){u.default.e(this.TAG,"IOException: type = "+e+", code = "+d.code+", msg = "+d.msg),this._emitter.emit(t.default.IO_ERROR,e,d),this._disableStatisticsReporter()},i.prototype._onDemuxException=function(e,d){u.default.e(this.TAG,"DemuxException: type = "+e+", info = "+d),this._emitter.emit(t.default.DEMUX_ERROR,e,d)},i.prototype._onRemuxerInitSegmentArrival=function(e,d){this._emitter.emit(t.default.INIT_SEGMENT,e,d)},i.prototype._onRemuxerMediaSegmentArrival=function(e,d){if(this._pendingSeekTime==null&&(this._emitter.emit(t.default.MEDIA_SEGMENT,e,d),this._pendingResolveSeekPoint!=null&&e==="video")){var c=d.info.syncPoints,_=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,s.default.safari&&c.length>0&&c[0].originalDts===_&&(_=c[0].pts),this._emitter.emit(t.default.RECOMMEND_SEEKPOINT,_)}},i.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},i.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},i.prototype._reportSegmentMediaInfo=function(e){var d=this._mediaInfo.segments[e],c=Object.assign({},d);c.duration=this._mediaInfo.duration,c.segmentCount=this._mediaInfo.segmentCount,delete c.segments,delete c.keyframesIndex,this._emitter.emit(t.default.MEDIA_INFO,c)},i.prototype._reportStatisticsInfo=function(){var e={};e.url=this._ioctl.currentURL,e.hasRedirect=this._ioctl.hasRedirect,e.hasRedirect&&(e.redirectedURL=this._ioctl.currentRedirectedURL),e.speed=this._ioctl.currentSpeed,e.loaderType=this._ioctl.loaderType,e.currentSegmentIndex=this._currentSegmentIndex,e.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(t.default.STATISTICS_INFO,e)},i}();S.default=a},"./src/core/transmuxing-events.js":function(T,S,p){p.r(S);var E={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};S.default=E},"./src/core/transmuxing-worker.js":function(T,S,p){p.r(S);var E=p("./src/utils/logging-control.js"),h=p("./src/utils/polyfill.js"),u=p("./src/core/transmuxing-controller.js"),s=p("./src/core/transmuxing-events.js"),f=function(n){var l=null,o=m.bind(this);h.default.install(),n.addEventListener("message",function(g){switch(g.data.cmd){case"init":l=new u.default(g.data.param[0],g.data.param[1]),l.on(s.default.IO_ERROR,v.bind(this)),l.on(s.default.DEMUX_ERROR,y.bind(this)),l.on(s.default.INIT_SEGMENT,r.bind(this)),l.on(s.default.MEDIA_SEGMENT,t.bind(this)),l.on(s.default.LOADING_COMPLETE,a.bind(this)),l.on(s.default.RECOVERED_EARLY_EOF,i.bind(this)),l.on(s.default.MEDIA_INFO,e.bind(this)),l.on(s.default.METADATA_ARRIVED,d.bind(this)),l.on(s.default.SCRIPTDATA_ARRIVED,c.bind(this)),l.on(s.default.STATISTICS_INFO,_.bind(this)),l.on(s.default.RECOMMEND_SEEKPOINT,x.bind(this));break;case"destroy":l&&(l.destroy(),l=null),n.postMessage({msg:"destroyed"});break;case"start":l.start();break;case"stop":l.stop();break;case"seek":l.seek(g.data.param);break;case"pause":l.pause();break;case"resume":l.resume();break;case"logging_config":{var b=g.data.param;E.default.applyConfig(b),b.enableCallback===!0?E.default.addLogListener(o):E.default.removeLogListener(o);break}}});function r(g,b){var C={msg:s.default.INIT_SEGMENT,data:{type:g,data:b}};n.postMessage(C,[b.data])}function t(g,b){var C={msg:s.default.MEDIA_SEGMENT,data:{type:g,data:b}};n.postMessage(C,[b.data])}function a(){var g={msg:s.default.LOADING_COMPLETE};n.postMessage(g)}function i(){var g={msg:s.default.RECOVERED_EARLY_EOF};n.postMessage(g)}function e(g){var b={msg:s.default.MEDIA_INFO,data:g};n.postMessage(b)}function d(g){var b={msg:s.default.METADATA_ARRIVED,data:g};n.postMessage(b)}function c(g){var b={msg:s.default.SCRIPTDATA_ARRIVED,data:g};n.postMessage(b)}function _(g){var b={msg:s.default.STATISTICS_INFO,data:g};n.postMessage(b)}function v(g,b){n.postMessage({msg:s.default.IO_ERROR,data:{type:g,info:b}})}function y(g,b){n.postMessage({msg:s.default.DEMUX_ERROR,data:{type:g,info:b}})}function x(g){n.postMessage({msg:s.default.RECOMMEND_SEEKPOINT,data:g})}function m(g,b){n.postMessage({msg:"logcat_callback",data:{type:g,logcat:b}})}};S.default=f},"./src/demux/amf-parser.js":function(T,S,p){p.r(S);var E=p("./src/utils/logger.js"),h=p("./src/utils/utf8-conv.js"),u=p("./src/utils/exception.js"),s=function(){var n=new ArrayBuffer(2);return new DataView(n).setInt16(0,256,!0),new Int16Array(n)[0]===256}(),f=function(){function n(){}return n.parseScriptData=function(l,o,r){var t={};try{var a=n.parseValue(l,o,r),i=n.parseValue(l,o+a.size,r-a.size);t[a.data]=i.data}catch(e){E.default.e("AMF",e.toString())}return t},n.parseObject=function(l,o,r){if(r<3)throw new u.IllegalStateException("Data not enough when parse ScriptDataObject");var t=n.parseString(l,o,r),a=n.parseValue(l,o+t.size,r-t.size),i=a.objectEnd;return{data:{name:t.data,value:a.data},size:t.size+a.size,objectEnd:i}},n.parseVariable=function(l,o,r){return n.parseObject(l,o,r)},n.parseString=function(l,o,r){if(r<2)throw new u.IllegalStateException("Data not enough when parse String");var t=new DataView(l,o,r),a=t.getUint16(0,!s),i;return a>0?i=(0,h.default)(new Uint8Array(l,o+2,a)):i="",{data:i,size:2+a}},n.parseLongString=function(l,o,r){if(r<4)throw new u.IllegalStateException("Data not enough when parse LongString");var t=new DataView(l,o,r),a=t.getUint32(0,!s),i;return a>0?i=(0,h.default)(new Uint8Array(l,o+4,a)):i="",{data:i,size:4+a}},n.parseDate=function(l,o,r){if(r<10)throw new u.IllegalStateException("Data size invalid when parse Date");var t=new DataView(l,o,r),a=t.getFloat64(0,!s),i=t.getInt16(8,!s);return a+=i*60*1e3,{data:new Date(a),size:10}},n.parseValue=function(l,o,r){if(r<1)throw new u.IllegalStateException("Data not enough when parse Value");var t=new DataView(l,o,r),a=1,i=t.getUint8(0),e,d=!1;try{switch(i){case 0:e=t.getFloat64(1,!s),a+=8;break;case 1:{var c=t.getUint8(1);e=!!c,a+=1;break}case 2:{var _=n.parseString(l,o+1,r-1);e=_.data,a+=_.size;break}case 3:{e={};var v=0;for((t.getUint32(r-4,!s)&16777215)===9&&(v=3);a<r-4;){var y=n.parseObject(l,o+a,r-a-v);if(y.objectEnd)break;e[y.data.name]=y.data.value,a+=y.size}if(a<=r-3){var x=t.getUint32(a-1,!s)&16777215;x===9&&(a+=3)}break}case 8:{e={},a+=4;var v=0;for((t.getUint32(r-4,!s)&16777215)===9&&(v=3);a<r-8;){var m=n.parseVariable(l,o+a,r-a-v);if(m.objectEnd)break;e[m.data.name]=m.data.value,a+=m.size}if(a<=r-3){var x=t.getUint32(a-1,!s)&16777215;x===9&&(a+=3)}break}case 9:e=void 0,a=1,d=!0;break;case 10:{e=[];var g=t.getUint32(1,!s);a+=4;for(var b=0;b<g;b++){var C=n.parseValue(l,o+a,r-a);e.push(C.data),a+=C.size}break}case 11:{var O=n.parseDate(l,o+1,r-1);e=O.data,a+=O.size;break}case 12:{var M=n.parseString(l,o+1,r-1);e=M.data,a+=M.size;break}default:a=r,E.default.w("AMF","Unsupported AMF value type "+i)}}catch(G){E.default.e("AMF",G.toString())}return{data:e,size:a,objectEnd:d}},n}();S.default=f},"./src/demux/demux-errors.js":function(T,S,p){p.r(S);var E={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};S.default=E},"./src/demux/exp-golomb.js":function(T,S,p){p.r(S);var E=p("./src/utils/exception.js"),h=function(){function u(s){this.TAG="ExpGolomb",this._buffer=s,this._buffer_index=0,this._total_bytes=s.byteLength,this._total_bits=s.byteLength*8,this._current_word=0,this._current_word_bits_left=0}return u.prototype.destroy=function(){this._buffer=null},u.prototype._fillCurrentWord=function(){var s=this._total_bytes-this._buffer_index;if(s<=0)throw new E.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var f=Math.min(4,s),n=new Uint8Array(4);n.set(this._buffer.subarray(this._buffer_index,this._buffer_index+f)),this._current_word=new DataView(n.buffer).getUint32(0,!1),this._buffer_index+=f,this._current_word_bits_left=f*8},u.prototype.readBits=function(s){if(s>32)throw new E.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(s<=this._current_word_bits_left){var f=this._current_word>>>32-s;return this._current_word<<=s,this._current_word_bits_left-=s,f}var n=this._current_word_bits_left?this._current_word:0;n=n>>>32-this._current_word_bits_left;var l=s-this._current_word_bits_left;this._fillCurrentWord();var o=Math.min(l,this._current_word_bits_left),r=this._current_word>>>32-o;return this._current_word<<=o,this._current_word_bits_left-=o,n=n<<o|r,n},u.prototype.readBool=function(){return this.readBits(1)===1},u.prototype.readByte=function(){return this.readBits(8)},u.prototype._skipLeadingZero=function(){var s;for(s=0;s<this._current_word_bits_left;s++)if(this._current_word&2147483648>>>s)return this._current_word<<=s,this._current_word_bits_left-=s,s;return this._fillCurrentWord(),s+this._skipLeadingZero()},u.prototype.readUEG=function(){var s=this._skipLeadingZero();return this.readBits(s+1)-1},u.prototype.readSEG=function(){var s=this.readUEG();return s&1?s+1>>>1:-1*(s>>>1)},u}();S.default=h},"./src/demux/flv-demuxer.js":function(T,S,p){p.r(S);var E=p("./src/utils/logger.js"),h=p("./src/demux/amf-parser.js"),u=p("./src/demux/sps-parser.js"),s=p("./src/demux/demux-errors.js"),f=p("./src/core/media-info.js"),n=p("./src/utils/exception.js");function l(r,t){return r[t]<<24|r[t+1]<<16|r[t+2]<<8|r[t+3]}var o=function(){function r(t,a){this.TAG="FLVDemuxer",this._config=a,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=t.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=t.hasAudioTrack,this._hasVideo=t.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new f.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var i=new ArrayBuffer(2);return new DataView(i).setInt16(0,256,!0),new Int16Array(i)[0]===256}()}return r.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},r.probe=function(t){var a=new Uint8Array(t),i={match:!1};if(a[0]!==70||a[1]!==76||a[2]!==86||a[3]!==1)return i;var e=(a[4]&4)>>>2!==0,d=(a[4]&1)!==0,c=l(a,5);return c<9?i:{match:!0,consumed:c,dataOffset:c,hasAudioTrack:e,hasVideoTrack:d}},r.prototype.bindDataSource=function(t){return t.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(r.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(t){this._onTrackMetadata=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(t){this._onMediaInfo=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(t){this._onMetaDataArrived=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(t){this._onScriptDataArrived=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(t){this._onDataAvailable=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(t){this._timestampBase=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"overridedDuration",{get:function(){return this._duration},set:function(t){this._durationOverrided=!0,this._duration=t,this._mediaInfo.duration=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"overridedHasAudio",{set:function(t){this._hasAudioFlagOverrided=!0,this._hasAudio=t,this._mediaInfo.hasAudio=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"overridedHasVideo",{set:function(t){this._hasVideoFlagOverrided=!0,this._hasVideo=t,this._mediaInfo.hasVideo=t},enumerable:!1,configurable:!0}),r.prototype.resetMediaInfo=function(){this._mediaInfo=new f.default},r.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:!1},r.prototype.parseChunks=function(t,a){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new n.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var i=0,e=this._littleEndian;if(a===0)if(t.byteLength>13){var d=r.probe(t);i=d.dataOffset}else return 0;if(this._firstParse){this._firstParse=!1,a+i!==this._dataOffset&&E.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var c=new DataView(t,i),_=c.getUint32(0,!e);_!==0&&E.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),i+=4}for(;i<t.byteLength;){this._dispatch=!0;var c=new DataView(t,i);if(i+11+4>t.byteLength)break;var v=c.getUint8(0),y=c.getUint32(0,!e)&16777215;if(i+11+y+4>t.byteLength)break;if(v!==8&&v!==9&&v!==18){E.default.w(this.TAG,"Unsupported tag type "+v+", skipped"),i+=11+y+4;continue}var x=c.getUint8(4),m=c.getUint8(5),g=c.getUint8(6),b=c.getUint8(7),C=g|m<<8|x<<16|b<<24,O=c.getUint32(7,!e)&16777215;O!==0&&E.default.w(this.TAG,"Meet tag which has StreamID != 0!");var M=i+11;switch(v){case 8:this._parseAudioData(t,M,y,C);break;case 9:this._parseVideoData(t,M,y,C,a+i);break;case 18:this._parseScriptData(t,M,y);break}var G=c.getUint32(11+y,!e);G!==11+y&&E.default.w(this.TAG,"Invalid PrevTagSize "+G),i+=11+y+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),i},r.prototype._parseScriptData=function(t,a,i){var e=h.default.parseScriptData(t,a,i);if(e.hasOwnProperty("onMetaData")){if(e.onMetaData==null||typeof e.onMetaData!="object"){E.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&E.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=e;var d=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},d)),typeof d.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=d.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof d.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=d.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof d.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=d.audiodatarate),typeof d.videodatarate=="number"&&(this._mediaInfo.videoDataRate=d.videodatarate),typeof d.width=="number"&&(this._mediaInfo.width=d.width),typeof d.height=="number"&&(this._mediaInfo.height=d.height),typeof d.duration=="number"){if(!this._durationOverrided){var c=Math.floor(d.duration*this._timescale);this._duration=c,this._mediaInfo.duration=c}}else this._mediaInfo.duration=0;if(typeof d.framerate=="number"){var _=Math.floor(d.framerate*1e3);if(_>0){var v=_/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=v,this._referenceFrameRate.fps_num=_,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=v}}if(typeof d.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var y=d.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(y),d.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=d,E.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(e).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},e))},r.prototype._parseKeyframesIndex=function(t){for(var a=[],i=[],e=1;e<t.times.length;e++){var d=this._timestampBase+Math.floor(t.times[e]*1e3);a.push(d),i.push(t.filepositions[e])}return{times:a,filepositions:i}},r.prototype._parseAudioData=function(t,a,i,e){if(i<=1){E.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!(this._hasAudioFlagOverrided===!0&&this._hasAudio===!1)){this._littleEndian;var d=new DataView(t,a,i),c=d.getUint8(0),_=c>>>4;if(_!==2&&_!==10){this._onError(s.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+_);return}var v=0,y=(c&12)>>>2;if(y>=0&&y<=4)v=this._flvSoundRateTable[y];else{this._onError(s.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+y);return}var x=c&1,m=this._audioMetadata,g=this._audioTrack;if(m||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),m=this._audioMetadata={},m.type="audio",m.id=g.id,m.timescale=this._timescale,m.duration=this._duration,m.audioSampleRate=v,m.channelCount=x===0?1:2),_===10){var b=this._parseAACAudioData(t,a+1,i-1);if(b==null)return;if(b.packetType===0){m.config&&E.default.w(this.TAG,"Found another AudioSpecificConfig!");var C=b.data;m.audioSampleRate=C.samplingRate,m.channelCount=C.channelCount,m.codec=C.codec,m.originalCodec=C.originalCodec,m.config=C.config,m.refSampleDuration=1024/m.audioSampleRate*m.timescale,E.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",m);var O=this._mediaInfo;O.audioCodec=m.originalCodec,O.audioSampleRate=m.audioSampleRate,O.audioChannelCount=m.channelCount,O.hasVideo?O.videoCodec!=null&&(O.mimeType='video/x-flv; codecs="'+O.videoCodec+","+O.audioCodec+'"'):O.mimeType='video/x-flv; codecs="'+O.audioCodec+'"',O.isComplete()&&this._onMediaInfo(O)}else if(b.packetType===1){var M=this._timestampBase+e,G={unit:b.data,length:b.data.byteLength,dts:M,pts:M};g.samples.push(G),g.length+=b.data.length}else E.default.e(this.TAG,"Flv: Unsupported AAC data type "+b.packetType)}else if(_===2){if(!m.codec){var C=this._parseMP3AudioData(t,a+1,i-1,!0);if(C==null)return;m.audioSampleRate=C.samplingRate,m.channelCount=C.channelCount,m.codec=C.codec,m.originalCodec=C.originalCodec,m.refSampleDuration=1152/m.audioSampleRate*m.timescale,E.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",m);var O=this._mediaInfo;O.audioCodec=m.codec,O.audioSampleRate=m.audioSampleRate,O.audioChannelCount=m.channelCount,O.audioDataRate=C.bitRate,O.hasVideo?O.videoCodec!=null&&(O.mimeType='video/x-flv; codecs="'+O.videoCodec+","+O.audioCodec+'"'):O.mimeType='video/x-flv; codecs="'+O.audioCodec+'"',O.isComplete()&&this._onMediaInfo(O)}var W=this._parseMP3AudioData(t,a+1,i-1,!1);if(W==null)return;var M=this._timestampBase+e,V={unit:W,length:W.byteLength,dts:M,pts:M};g.samples.push(V),g.length+=W.length}}},r.prototype._parseAACAudioData=function(t,a,i){if(i<=1){E.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var e={},d=new Uint8Array(t,a,i);return e.packetType=d[0],d[0]===0?e.data=this._parseAACAudioSpecificConfig(t,a+1,i-1):e.data=d.subarray(1),e},r.prototype._parseAACAudioSpecificConfig=function(t,a,i){var e=new Uint8Array(t,a,i),d=null,c=0,_=0,v=0,y=null;if(c=_=e[0]>>>3,v=(e[0]&7)<<1|e[1]>>>7,v<0||v>=this._mpegSamplingRates.length){this._onError(s.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var x=this._mpegSamplingRates[v],m=(e[1]&120)>>>3;if(m<0||m>=8){this._onError(s.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}c===5&&(y=(e[1]&7)<<1|e[2]>>>7,(e[2]&124)>>>2);var g=self.navigator.userAgent.toLowerCase();return g.indexOf("firefox")!==-1?v>=6?(c=5,d=new Array(4),y=v-3):(c=2,d=new Array(2),y=v):g.indexOf("android")!==-1?(c=2,d=new Array(2),y=v):(c=5,y=v,d=new Array(4),v>=6?y=v-3:m===1&&(c=2,d=new Array(2),y=v)),d[0]=c<<3,d[0]|=(v&15)>>>1,d[1]=(v&15)<<7,d[1]|=(m&15)<<3,c===5&&(d[1]|=(y&15)>>>1,d[2]=(y&1)<<7,d[2]|=8,d[3]=0),{config:d,samplingRate:x,channelCount:m,codec:"mp4a.40."+c,originalCodec:"mp4a.40."+_}},r.prototype._parseMP3AudioData=function(t,a,i,e){if(i<4){E.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var d=new Uint8Array(t,a,i),c=null;if(e){if(d[0]!==255)return;var _=d[1]>>>3&3,v=(d[1]&6)>>1,y=(d[2]&240)>>>4,x=(d[2]&12)>>>2,m=d[3]>>>6&3,g=m!==3?2:1,b=0,C=0,O="mp3";switch(_){case 0:b=this._mpegAudioV25SampleRateTable[x];break;case 2:b=this._mpegAudioV20SampleRateTable[x];break;case 3:b=this._mpegAudioV10SampleRateTable[x];break}switch(v){case 1:y<this._mpegAudioL3BitRateTable.length&&(C=this._mpegAudioL3BitRateTable[y]);break;case 2:y<this._mpegAudioL2BitRateTable.length&&(C=this._mpegAudioL2BitRateTable[y]);break;case 3:y<this._mpegAudioL1BitRateTable.length&&(C=this._mpegAudioL1BitRateTable[y]);break}c={bitRate:C,samplingRate:b,channelCount:g,codec:O,originalCodec:O}}else c=d;return c},r.prototype._parseVideoData=function(t,a,i,e,d){if(i<=1){E.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!(this._hasVideoFlagOverrided===!0&&this._hasVideo===!1)){var c=new Uint8Array(t,a,i)[0],_=(c&240)>>>4,v=c&15;if(v!==7){this._onError(s.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+v);return}this._parseAVCVideoPacket(t,a+1,i-1,e,d,_)}},r.prototype._parseAVCVideoPacket=function(t,a,i,e,d,c){if(i<4){E.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var _=this._littleEndian,v=new DataView(t,a,i),y=v.getUint8(0),x=v.getUint32(0,!_)&16777215,m=x<<8>>8;if(y===0)this._parseAVCDecoderConfigurationRecord(t,a+4,i-4);else if(y===1)this._parseAVCVideoData(t,a+4,i-4,e,d,c,m);else if(y!==2){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid video packet type "+y);return}},r.prototype._parseAVCDecoderConfigurationRecord=function(t,a,i){if(i<7){E.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var e=this._videoMetadata,d=this._videoTrack,c=this._littleEndian,_=new DataView(t,a,i);e?typeof e.avcc<"u"&&E.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),e=this._videoMetadata={},e.type="video",e.id=d.id,e.timescale=this._timescale,e.duration=this._duration);var v=_.getUint8(0),y=_.getUint8(1);if(_.getUint8(2),_.getUint8(3),v!==1||y===0){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(_.getUint8(4)&3)+1,this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(s.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var x=_.getUint8(5)&31;if(x===0){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else x>1&&E.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+x);for(var m=6,g=0;g<x;g++){var b=_.getUint16(m,!c);if(m+=2,b!==0){var C=new Uint8Array(t,a+m,b);m+=b;var O=u.default.parseSPS(C);if(g===0){e.codecWidth=O.codec_size.width,e.codecHeight=O.codec_size.height,e.presentWidth=O.present_size.width,e.presentHeight=O.present_size.height,e.profile=O.profile_string,e.level=O.level_string,e.bitDepth=O.bit_depth,e.chromaFormat=O.chroma_format,e.sarRatio=O.sar_ratio,e.frameRate=O.frame_rate,(O.frame_rate.fixed===!1||O.frame_rate.fps_num===0||O.frame_rate.fps_den===0)&&(e.frameRate=this._referenceFrameRate);var M=e.frameRate.fps_den,G=e.frameRate.fps_num;e.refSampleDuration=e.timescale*(M/G);for(var W=C.subarray(1,4),V="avc1.",X=0;X<3;X++){var te=W[X].toString(16);te.length<2&&(te="0"+te),V+=te}e.codec=V;var N=this._mediaInfo;N.width=e.codecWidth,N.height=e.codecHeight,N.fps=e.frameRate.fps,N.profile=e.profile,N.level=e.level,N.refFrames=O.ref_frames,N.chromaFormat=O.chroma_format_string,N.sarNum=e.sarRatio.width,N.sarDen=e.sarRatio.height,N.videoCodec=V,N.hasAudio?N.audioCodec!=null&&(N.mimeType='video/x-flv; codecs="'+N.videoCodec+","+N.audioCodec+'"'):N.mimeType='video/x-flv; codecs="'+N.videoCodec+'"',N.isComplete()&&this._onMediaInfo(N)}}}var Z=_.getUint8(m);if(Z===0){this._onError(s.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else Z>1&&E.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+Z);m++;for(var g=0;g<Z;g++){var b=_.getUint16(m,!c);m+=2,b!==0&&(m+=b)}e.avcc=new Uint8Array(i),e.avcc.set(new Uint8Array(t,a,i),0),E.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",e)},r.prototype._parseAVCVideoData=function(t,a,i,e,d,c,_){for(var v=this._littleEndian,y=new DataView(t,a,i),x=[],m=0,g=0,b=this._naluLengthSize,C=this._timestampBase+e,O=c===1;g<i;){if(g+4>=i){E.default.w(this.TAG,"Malformed Nalu near timestamp "+C+", offset = "+g+", dataSize = "+i);break}var M=y.getUint32(g,!v);if(b===3&&(M>>>=8),M>i-b){E.default.w(this.TAG,"Malformed Nalus near timestamp "+C+", NaluSize > DataSize!");return}var G=y.getUint8(g+b)&31;G===5&&(O=!0);var W=new Uint8Array(t,a+g,b+M),V={type:G,data:W};x.push(V),m+=W.byteLength,g+=b+M}if(x.length){var X=this._videoTrack,te={units:x,length:m,isKeyframe:O,dts:C,cts:_,pts:C+_};O&&(te.fileposition=d),X.samples.push(te),X.length+=m}},r}();S.default=o},"./src/demux/sps-parser.js":function(T,S,p){p.r(S);var E=p("./src/demux/exp-golomb.js"),h=function(){function u(){}return u._ebsp2rbsp=function(s){for(var f=s,n=f.byteLength,l=new Uint8Array(n),o=0,r=0;r<n;r++)r>=2&&f[r]===3&&f[r-1]===0&&f[r-2]===0||(l[o]=f[r],o++);return new Uint8Array(l.buffer,0,o)},u.parseSPS=function(s){var f=u._ebsp2rbsp(s),n=new E.default(f);n.readByte();var l=n.readByte();n.readByte();var o=n.readByte();n.readUEG();var r=u.getProfileString(l),t=u.getLevelString(o),a=1,i=420,e=[0,420,422,444],d=8;if((l===100||l===110||l===122||l===244||l===44||l===83||l===86||l===118||l===128||l===138||l===144)&&(a=n.readUEG(),a===3&&n.readBits(1),a<=3&&(i=e[a]),d=n.readUEG()+8,n.readUEG(),n.readBits(1),n.readBool()))for(var c=a!==3?8:12,_=0;_<c;_++)n.readBool()&&(_<6?u._skipScalingList(n,16):u._skipScalingList(n,64));n.readUEG();var v=n.readUEG();if(v===0)n.readUEG();else if(v===1){n.readBits(1),n.readSEG(),n.readSEG();for(var y=n.readUEG(),_=0;_<y;_++)n.readSEG()}var x=n.readUEG();n.readBits(1);var m=n.readUEG(),g=n.readUEG(),b=n.readBits(1);b===0&&n.readBits(1),n.readBits(1);var C=0,O=0,M=0,G=0,W=n.readBool();W&&(C=n.readUEG(),O=n.readUEG(),M=n.readUEG(),G=n.readUEG());var V=1,X=1,te=0,N=!0,Z=0,ae=0,q=n.readBool();if(q){if(n.readBool()){var L=n.readByte(),j=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],k=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];L>0&&L<16?(V=j[L-1],X=k[L-1]):L===255&&(V=n.readByte()<<8|n.readByte(),X=n.readByte()<<8|n.readByte())}if(n.readBool()&&n.readBool(),n.readBool()&&(n.readBits(4),n.readBool()&&n.readBits(24)),n.readBool()&&(n.readUEG(),n.readUEG()),n.readBool()){var $=n.readBits(32),ee=n.readBits(32);N=n.readBool(),Z=ee,ae=$*2,te=Z/ae}}var z=1;(V!==1||X!==1)&&(z=V/X);var w=0,re=0;if(a===0)w=1,re=2-b;else{var se=a===3?1:2,ve=a===1?2:1;w=se,re=ve*(2-b)}var fe=(m+1)*16,pe=(2-b)*((g+1)*16);fe-=(C+O)*w,pe-=(M+G)*re;var ge=Math.ceil(fe*z);return n.destroy(),n=null,{profile_string:r,level_string:t,bit_depth:d,ref_frames:x,chroma_format:i,chroma_format_string:u.getChromaFormatString(i),frame_rate:{fixed:N,fps:te,fps_den:ae,fps_num:Z},sar_ratio:{width:V,height:X},codec_size:{width:fe,height:pe},present_size:{width:ge,height:pe}}},u._skipScalingList=function(s,f){for(var n=8,l=8,o=0,r=0;r<f;r++)l!==0&&(o=s.readSEG(),l=(n+o+256)%256),n=l===0?n:l},u.getProfileString=function(s){switch(s){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},u.getLevelString=function(s){return(s/10).toFixed(1)},u.getChromaFormatString=function(s){switch(s){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},u}();S.default=h},"./src/flv.js":function(T,S,p){p.r(S);var E=p("./src/utils/polyfill.js"),h=p("./src/core/features.js"),u=p("./src/io/loader.js"),s=p("./src/player/flv-player.js"),f=p("./src/player/native-player.js"),n=p("./src/player/player-events.js"),l=p("./src/player/player-errors.js"),o=p("./src/utils/logging-control.js"),r=p("./src/utils/exception.js");E.default.install();function t(d,c){var _=d;if(_==null||typeof _!="object")throw new r.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!_.hasOwnProperty("type"))throw new r.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(_.type){case"flv":return new s.default(_,c);default:return new f.default(_,c)}}function a(){return h.default.supportMSEH264Playback()}function i(){return h.default.getFeatureList()}var e={};e.createPlayer=t,e.isSupported=a,e.getFeatureList=i,e.BaseLoader=u.BaseLoader,e.LoaderStatus=u.LoaderStatus,e.LoaderErrors=u.LoaderErrors,e.Events=n.default,e.ErrorTypes=l.ErrorTypes,e.ErrorDetails=l.ErrorDetails,e.FlvPlayer=s.default,e.NativePlayer=f.default,e.LoggingControl=o.default,Object.defineProperty(e,"version",{enumerable:!0,get:function(){return"1.6.2"}}),S.default=e},"./src/index.js":function(T,S,p){T.exports=p("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(T,S,p){p.r(S);var E=p("./src/utils/browser.js"),h=p("./src/io/loader.js"),u=p("./src/utils/exception.js"),s=function(){var n=function(l,o){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])},n(l,o)};return function(l,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");n(l,o);function r(){this.constructor=l}l.prototype=o===null?Object.create(o):(r.prototype=o.prototype,new r)}}(),f=function(n){s(l,n);function l(o,r){var t=n.call(this,"fetch-stream-loader")||this;return t.TAG="FetchStreamLoader",t._seekHandler=o,t._config=r,t._needStash=!0,t._requestAbort=!1,t._contentLength=null,t._receivedLength=0,t}return l.isSupported=function(){try{var o=E.default.msedge&&E.default.version.minor>=15048,r=E.default.msedge?o:!0;return self.fetch&&self.ReadableStream&&r}catch{return!1}},l.prototype.destroy=function(){this.isWorking()&&this.abort(),n.prototype.destroy.call(this)},l.prototype.open=function(o,r){var t=this;this._dataSource=o,this._range=r;var a=o.url;this._config.reuseRedirectedURL&&o.redirectedURL!=null&&(a=o.redirectedURL);var i=this._seekHandler.getConfig(a,r),e=new self.Headers;if(typeof i.headers=="object"){var d=i.headers;for(var c in d)d.hasOwnProperty(c)&&e.append(c,d[c])}var _={method:"GET",headers:e,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var c in this._config.headers)e.append(c,this._config.headers[c]);o.cors===!1&&(_.mode="same-origin"),o.withCredentials&&(_.credentials="include"),o.referrerPolicy&&(_.referrerPolicy=o.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,_.signal=this._abortController.signal),this._status=h.LoaderStatus.kConnecting,self.fetch(i.url,_).then(function(v){if(t._requestAbort){t._status=h.LoaderStatus.kIdle,v.body.cancel();return}if(v.ok&&v.status>=200&&v.status<=299){if(v.url!==i.url&&t._onURLRedirect){var y=t._seekHandler.removeURLParameters(v.url);t._onURLRedirect(y)}var x=v.headers.get("Content-Length");return x!=null&&(t._contentLength=parseInt(x),t._contentLength!==0&&t._onContentLengthKnown&&t._onContentLengthKnown(t._contentLength)),t._pump.call(t,v.body.getReader())}else if(t._status=h.LoaderStatus.kError,t._onError)t._onError(h.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:v.status,msg:v.statusText});else throw new u.RuntimeException("FetchStreamLoader: Http code invalid, "+v.status+" "+v.statusText)}).catch(function(v){if(!(t._abortController&&t._abortController.signal.aborted))if(t._status=h.LoaderStatus.kError,t._onError)t._onError(h.LoaderErrors.EXCEPTION,{code:-1,msg:v.message});else throw v})},l.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==h.LoaderStatus.kBuffering||!E.default.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},l.prototype._pump=function(o){var r=this;return o.read().then(function(t){if(t.done)if(r._contentLength!==null&&r._receivedLength<r._contentLength){r._status=h.LoaderStatus.kError;var a=h.LoaderErrors.EARLY_EOF,i={code:-1,msg:"Fetch stream meet Early-EOF"};if(r._onError)r._onError(a,i);else throw new u.RuntimeException(i.msg)}else r._status=h.LoaderStatus.kComplete,r._onComplete&&r._onComplete(r._range.from,r._range.from+r._receivedLength-1);else{if(r._abortController&&r._abortController.signal.aborted){r._status=h.LoaderStatus.kComplete;return}else if(r._requestAbort===!0)return r._status=h.LoaderStatus.kComplete,o.cancel();r._status=h.LoaderStatus.kBuffering;var e=t.value.buffer,d=r._range.from+r._receivedLength;r._receivedLength+=e.byteLength,r._onDataArrival&&r._onDataArrival(e,d,r._receivedLength),r._pump(o)}}).catch(function(t){if(r._abortController&&r._abortController.signal.aborted){r._status=h.LoaderStatus.kComplete;return}if(!(t.code===11&&E.default.msedge)){r._status=h.LoaderStatus.kError;var a=0,i=null;if((t.code===19||t.message==="network error")&&(r._contentLength===null||r._contentLength!==null&&r._receivedLength<r._contentLength)?(a=h.LoaderErrors.EARLY_EOF,i={code:t.code,msg:"Fetch stream meet Early-EOF"}):(a=h.LoaderErrors.EXCEPTION,i={code:t.code,msg:t.message}),r._onError)r._onError(a,i);else throw new u.RuntimeException(i.msg)}})},l}(h.BaseLoader);S.default=f},"./src/io/io-controller.js":function(T,S,p){p.r(S);var E=p("./src/utils/logger.js"),h=p("./src/io/speed-sampler.js"),u=p("./src/io/loader.js"),s=p("./src/io/fetch-stream-loader.js"),f=p("./src/io/xhr-moz-chunked-loader.js"),n=p("./src/io/xhr-range-loader.js"),l=p("./src/io/websocket-loader.js"),o=p("./src/io/range-seek-handler.js"),r=p("./src/io/param-seek-handler.js"),t=p("./src/utils/exception.js"),a=function(){function i(e,d,c){this.TAG="IOController",this._config=d,this._extraData=c,this._stashInitialSize=1024*384,d.stashInitialSize!=null&&d.stashInitialSize>0&&(this._stashInitialSize=d.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=1024*1024*3,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,d.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=e,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(e.url),this._refTotalLength=e.filesize?e.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new h.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return i.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},i.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},i.prototype.isPaused=function(){return this._paused},Object.defineProperty(i.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"extraData",{get:function(){return this._extraData},set:function(e){this._extraData=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(e){this._onSeeked=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onComplete",{get:function(){return this._onComplete},set:function(e){this._onComplete=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(e){this._onRedirect=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(e){this._onRecoveredEarlyEof=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentSpeed",{get:function(){return this._loaderClass===n.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),i.prototype._selectSeekHandler=function(){var e=this._config;if(e.seekType==="range")this._seekHandler=new o.default(this._config.rangeLoadZeroStart);else if(e.seekType==="param"){var d=e.seekParamStart||"bstart",c=e.seekParamEnd||"bend";this._seekHandler=new r.default(d,c)}else if(e.seekType==="custom"){if(typeof e.customSeekHandler!="function")throw new t.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new e.customSeekHandler}else throw new t.InvalidArgumentException("Invalid seekType in config: "+e.seekType)},i.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=l.default;else if(s.default.isSupported())this._loaderClass=s.default;else if(f.default.isSupported())this._loaderClass=f.default;else if(n.default.isSupported())this._loaderClass=n.default;else throw new t.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},i.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},i.prototype.open=function(e){this._currentRange={from:0,to:-1},e&&(this._currentRange.from=e),this._speedSampler.reset(),e||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},i.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},i.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},i.prototype.resume=function(){if(this._paused){this._paused=!1;var e=this._resumeFrom;this._resumeFrom=0,this._internalSeek(e,!0)}},i.prototype.seek=function(e){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(e,!0)},i.prototype._internalSeek=function(e,d){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(d),this._loader.destroy(),this._loader=null;var c={from:e,to:-1};this._currentRange={from:c.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,c),this._onSeeked&&this._onSeeked()},i.prototype.updateUrl=function(e){if(!e||typeof e!="string"||e.length===0)throw new t.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=e},i.prototype._expandBuffer=function(e){for(var d=this._stashSize;d+1024*1024*1<e;)d*=2;if(d+=1024*1024*1,d!==this._bufferSize){var c=new ArrayBuffer(d);if(this._stashUsed>0){var _=new Uint8Array(this._stashBuffer,0,this._stashUsed),v=new Uint8Array(c,0,d);v.set(_,0)}this._stashBuffer=c,this._bufferSize=d}},i.prototype._normalizeSpeed=function(e){var d=this._speedNormalizeList,c=d.length-1,_=0,v=0,y=c;if(e<d[0])return d[0];for(;v<=y;){if(_=v+Math.floor((y-v)/2),_===c||e>=d[_]&&e<d[_+1])return d[_];d[_]<e?v=_+1:y=_-1}},i.prototype._adjustStashSize=function(e){var d=0;this._config.isLive||e<512?d=e:e>=512&&e<=1024?d=Math.floor(e*1.5):d=e*2,d>8192&&(d=8192);var c=d*1024+1024*1024*1;this._bufferSize<c&&this._expandBuffer(c),this._stashSize=d*1024},i.prototype._dispatchChunks=function(e,d){return this._currentRange.to=d+e.byteLength-1,this._onDataArrival(e,d)},i.prototype._onURLRedirect=function(e){this._redirectedURL=e,this._onRedirect&&this._onRedirect(e)},i.prototype._onContentLengthKnown=function(e){e&&this._fullRequestFlag&&(this._totalLength=e,this._fullRequestFlag=!1)},i.prototype._onLoaderChunkArrival=function(e,d,c){if(!this._onDataArrival)throw new t.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(e.byteLength);var _=this._speedSampler.lastSecondKBps;if(_!==0){var v=this._normalizeSpeed(_);this._speedNormalized!==v&&(this._speedNormalized=v,this._adjustStashSize(v))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=d),this._stashUsed+e.byteLength<=this._stashSize){var m=new Uint8Array(this._stashBuffer,0,this._stashSize);m.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var m=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var b=this._stashBuffer.slice(0,this._stashUsed),y=this._dispatchChunks(b,this._stashByteStart);if(y<b.byteLength){if(y>0){var g=new Uint8Array(b,y);m.set(g,0),this._stashUsed=g.byteLength,this._stashByteStart+=y}}else this._stashUsed=0,this._stashByteStart+=y;this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),m=new Uint8Array(this._stashBuffer,0,this._bufferSize)),m.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var y=this._dispatchChunks(e,d);if(y<e.byteLength){var x=e.byteLength-y;x>this._bufferSize&&(this._expandBuffer(x),m=new Uint8Array(this._stashBuffer,0,this._bufferSize)),m.set(new Uint8Array(e,y),0),this._stashUsed+=x,this._stashByteStart=d+y}}}else if(this._stashUsed===0){var y=this._dispatchChunks(e,d);if(y<e.byteLength){var x=e.byteLength-y;x>this._bufferSize&&this._expandBuffer(x);var m=new Uint8Array(this._stashBuffer,0,this._bufferSize);m.set(new Uint8Array(e,y),0),this._stashUsed+=x,this._stashByteStart=d+y}}else{this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength);var m=new Uint8Array(this._stashBuffer,0,this._bufferSize);m.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;var y=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(y<this._stashUsed&&y>0){var g=new Uint8Array(this._stashBuffer,y);m.set(g,0)}this._stashUsed-=y,this._stashByteStart+=y}}},i.prototype._flushStashBuffer=function(e){if(this._stashUsed>0){var d=this._stashBuffer.slice(0,this._stashUsed),c=this._dispatchChunks(d,this._stashByteStart),_=d.byteLength-c;if(c<d.byteLength)if(e)E.default.w(this.TAG,_+" bytes unconsumed data remain when flush buffer, dropped");else{if(c>0){var v=new Uint8Array(this._stashBuffer,0,this._bufferSize),y=new Uint8Array(d,c);v.set(y,0),this._stashUsed=y.byteLength,this._stashByteStart+=c}return 0}return this._stashUsed=0,this._stashByteStart=0,_}return 0},i.prototype._onLoaderComplete=function(e,d){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},i.prototype._onLoaderError=function(e,d){switch(E.default.e(this.TAG,"Loader error, code = "+d.code+", msg = "+d.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,e=u.LoaderErrors.UNRECOVERABLE_EARLY_EOF),e){case u.LoaderErrors.EARLY_EOF:{if(!this._config.isLive&&this._totalLength){var c=this._currentRange.to+1;c<this._totalLength&&(E.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(c,!1));return}e=u.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case u.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case u.LoaderErrors.CONNECTING_TIMEOUT:case u.LoaderErrors.HTTP_STATUS_CODE_INVALID:case u.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(e,d);else throw new t.RuntimeException("IOException: "+d.msg)},i}();S.default=a},"./src/io/loader.js":function(T,S,p){p.r(S),p.d(S,{LoaderStatus:function(){return h},LoaderErrors:function(){return u},BaseLoader:function(){return s}});var E=p("./src/utils/exception.js"),h={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},u={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},s=function(){function f(n){this._type=n||"undefined",this._status=h.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return f.prototype.destroy=function(){this._status=h.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},f.prototype.isWorking=function(){return this._status===h.kConnecting||this._status===h.kBuffering},Object.defineProperty(f.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(n){this._onContentLengthKnown=n},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(n){this._onURLRedirect=n},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(n){this._onDataArrival=n},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onError",{get:function(){return this._onError},set:function(n){this._onError=n},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onComplete",{get:function(){return this._onComplete},set:function(n){this._onComplete=n},enumerable:!1,configurable:!0}),f.prototype.open=function(n,l){throw new E.NotImplementedException("Unimplemented abstract function!")},f.prototype.abort=function(){throw new E.NotImplementedException("Unimplemented abstract function!")},f}()},"./src/io/param-seek-handler.js":function(T,S,p){p.r(S);var E=function(){function h(u,s){this._startName=u,this._endName=s}return h.prototype.getConfig=function(u,s){var f=u;if(s.from!==0||s.to!==-1){var n=!0;f.indexOf("?")===-1&&(f+="?",n=!1),n&&(f+="&"),f+=this._startName+"="+s.from.toString(),s.to!==-1&&(f+="&"+this._endName+"="+s.to.toString())}return{url:f,headers:{}}},h.prototype.removeURLParameters=function(u){var s=u.split("?")[0],f=void 0,n=u.indexOf("?");n!==-1&&(f=u.substring(n+1));var l="";if(f!=null&&f.length>0)for(var o=f.split("&"),r=0;r<o.length;r++){var t=o[r].split("="),a=r>0;t[0]!==this._startName&&t[0]!==this._endName&&(a&&(l+="&"),l+=o[r])}return l.length===0?s:s+"?"+l},h}();S.default=E},"./src/io/range-seek-handler.js":function(T,S,p){p.r(S);var E=function(){function h(u){this._zeroStart=u||!1}return h.prototype.getConfig=function(u,s){var f={};if(s.from!==0||s.to!==-1){var n=void 0;s.to!==-1?n="bytes="+s.from.toString()+"-"+s.to.toString():n="bytes="+s.from.toString()+"-",f.Range=n}else this._zeroStart&&(f.Range="bytes=0-");return{url:u,headers:f}},h.prototype.removeURLParameters=function(u){return u},h}();S.default=E},"./src/io/speed-sampler.js":function(T,S,p){p.r(S);var E=function(){function h(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return h.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},h.prototype.addBytes=function(u){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=u,this._totalBytes+=u):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=u,this._totalBytes+=u):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=u,this._totalBytes+=u,this._lastCheckpoint=this._now())},Object.defineProperty(h.prototype,"currentKBps",{get:function(){this.addBytes(0);var u=(this._now()-this._lastCheckpoint)/1e3;return u==0&&(u=1),this._intervalBytes/u/1024},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"averageKBps",{get:function(){var u=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/u/1024},enumerable:!1,configurable:!0}),h}();S.default=E},"./src/io/websocket-loader.js":function(T,S,p){p.r(S);var E=p("./src/io/loader.js"),h=p("./src/utils/exception.js"),u=function(){var f=function(n,l){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,r){o.__proto__=r}||function(o,r){for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(o[t]=r[t])},f(n,l)};return function(n,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");f(n,l);function o(){this.constructor=n}n.prototype=l===null?Object.create(l):(o.prototype=l.prototype,new o)}}(),s=function(f){u(n,f);function n(){var l=f.call(this,"websocket-loader")||this;return l.TAG="WebSocketLoader",l._needStash=!0,l._ws=null,l._requestAbort=!1,l._receivedLength=0,l}return n.isSupported=function(){try{return typeof self.WebSocket<"u"}catch{return!1}},n.prototype.destroy=function(){this._ws&&this.abort(),f.prototype.destroy.call(this)},n.prototype.open=function(l){try{var o=this._ws=new self.WebSocket(l.url);o.binaryType="arraybuffer",o.onopen=this._onWebSocketOpen.bind(this),o.onclose=this._onWebSocketClose.bind(this),o.onmessage=this._onWebSocketMessage.bind(this),o.onerror=this._onWebSocketError.bind(this),this._status=E.LoaderStatus.kConnecting}catch(t){this._status=E.LoaderStatus.kError;var r={code:t.code,msg:t.message};if(this._onError)this._onError(E.LoaderErrors.EXCEPTION,r);else throw new h.RuntimeException(r.msg)}},n.prototype.abort=function(){var l=this._ws;l&&(l.readyState===0||l.readyState===1)&&(this._requestAbort=!0,l.close()),this._ws=null,this._status=E.LoaderStatus.kComplete},n.prototype._onWebSocketOpen=function(l){this._status=E.LoaderStatus.kBuffering},n.prototype._onWebSocketClose=function(l){if(this._requestAbort===!0){this._requestAbort=!1;return}this._status=E.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},n.prototype._onWebSocketMessage=function(l){var o=this;if(l.data instanceof ArrayBuffer)this._dispatchArrayBuffer(l.data);else if(l.data instanceof Blob){var r=new FileReader;r.onload=function(){o._dispatchArrayBuffer(r.result)},r.readAsArrayBuffer(l.data)}else{this._status=E.LoaderStatus.kError;var t={code:-1,msg:"Unsupported WebSocket message type: "+l.data.constructor.name};if(this._onError)this._onError(E.LoaderErrors.EXCEPTION,t);else throw new h.RuntimeException(t.msg)}},n.prototype._dispatchArrayBuffer=function(l){var o=l,r=this._receivedLength;this._receivedLength+=o.byteLength,this._onDataArrival&&this._onDataArrival(o,r,this._receivedLength)},n.prototype._onWebSocketError=function(l){this._status=E.LoaderStatus.kError;var o={code:l.code,msg:l.message};if(this._onError)this._onError(E.LoaderErrors.EXCEPTION,o);else throw new h.RuntimeException(o.msg)},n}(E.BaseLoader);S.default=s},"./src/io/xhr-moz-chunked-loader.js":function(T,S,p){p.r(S);var E=p("./src/utils/logger.js"),h=p("./src/io/loader.js"),u=p("./src/utils/exception.js"),s=function(){var n=function(l,o){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])},n(l,o)};return function(l,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");n(l,o);function r(){this.constructor=l}l.prototype=o===null?Object.create(o):(r.prototype=o.prototype,new r)}}(),f=function(n){s(l,n);function l(o,r){var t=n.call(this,"xhr-moz-chunked-loader")||this;return t.TAG="MozChunkedLoader",t._seekHandler=o,t._config=r,t._needStash=!0,t._xhr=null,t._requestAbort=!1,t._contentLength=null,t._receivedLength=0,t}return l.isSupported=function(){try{var o=new XMLHttpRequest;return o.open("GET","https://example.com",!0),o.responseType="moz-chunked-arraybuffer",o.responseType==="moz-chunked-arraybuffer"}catch(r){return E.default.w("MozChunkedLoader",r.message),!1}},l.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),n.prototype.destroy.call(this)},l.prototype.open=function(o,r){this._dataSource=o,this._range=r;var t=o.url;this._config.reuseRedirectedURL&&o.redirectedURL!=null&&(t=o.redirectedURL);var a=this._seekHandler.getConfig(t,r);this._requestURL=a.url;var i=this._xhr=new XMLHttpRequest;if(i.open("GET",a.url,!0),i.responseType="moz-chunked-arraybuffer",i.onreadystatechange=this._onReadyStateChange.bind(this),i.onprogress=this._onProgress.bind(this),i.onloadend=this._onLoadEnd.bind(this),i.onerror=this._onXhrError.bind(this),o.withCredentials&&(i.withCredentials=!0),typeof a.headers=="object"){var e=a.headers;for(var d in e)e.hasOwnProperty(d)&&i.setRequestHeader(d,e[d])}if(typeof this._config.headers=="object"){var e=this._config.headers;for(var d in e)e.hasOwnProperty(d)&&i.setRequestHeader(d,e[d])}this._status=h.LoaderStatus.kConnecting,i.send()},l.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=h.LoaderStatus.kComplete},l.prototype._onReadyStateChange=function(o){var r=o.target;if(r.readyState===2){if(r.responseURL!=null&&r.responseURL!==this._requestURL&&this._onURLRedirect){var t=this._seekHandler.removeURLParameters(r.responseURL);this._onURLRedirect(t)}if(r.status!==0&&(r.status<200||r.status>299))if(this._status=h.LoaderStatus.kError,this._onError)this._onError(h.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:r.status,msg:r.statusText});else throw new u.RuntimeException("MozChunkedLoader: Http code invalid, "+r.status+" "+r.statusText);else this._status=h.LoaderStatus.kBuffering}},l.prototype._onProgress=function(o){if(this._status!==h.LoaderStatus.kError){this._contentLength===null&&o.total!==null&&o.total!==0&&(this._contentLength=o.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var r=o.target.response,t=this._range.from+this._receivedLength;this._receivedLength+=r.byteLength,this._onDataArrival&&this._onDataArrival(r,t,this._receivedLength)}},l.prototype._onLoadEnd=function(o){if(this._requestAbort===!0){this._requestAbort=!1;return}else if(this._status===h.LoaderStatus.kError)return;this._status=h.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)},l.prototype._onXhrError=function(o){this._status=h.LoaderStatus.kError;var r=0,t=null;if(this._contentLength&&o.loaded<this._contentLength?(r=h.LoaderErrors.EARLY_EOF,t={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(r=h.LoaderErrors.EXCEPTION,t={code:-1,msg:o.constructor.name+" "+o.type}),this._onError)this._onError(r,t);else throw new u.RuntimeException(t.msg)},l}(h.BaseLoader);S.default=f},"./src/io/xhr-range-loader.js":function(T,S,p){p.r(S);var E=p("./src/utils/logger.js"),h=p("./src/io/speed-sampler.js"),u=p("./src/io/loader.js"),s=p("./src/utils/exception.js"),f=function(){var l=function(o,r){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,a){t.__proto__=a}||function(t,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i])},l(o,r)};return function(o,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");l(o,r);function t(){this.constructor=o}o.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}}(),n=function(l){f(o,l);function o(r,t){var a=l.call(this,"xhr-range-loader")||this;return a.TAG="RangeLoader",a._seekHandler=r,a._config=t,a._needStash=!1,a._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],a._currentChunkSizeKB=384,a._currentSpeedNormalized=0,a._zeroSpeedChunkCount=0,a._xhr=null,a._speedSampler=new h.default,a._requestAbort=!1,a._waitForTotalLength=!1,a._totalLengthReceived=!1,a._currentRequestURL=null,a._currentRedirectedURL=null,a._currentRequestRange=null,a._totalLength=null,a._contentLength=null,a._receivedLength=0,a._lastTimeLoaded=0,a}return o.isSupported=function(){try{var r=new XMLHttpRequest;return r.open("GET","https://example.com",!0),r.responseType="arraybuffer",r.responseType==="arraybuffer"}catch(t){return E.default.w("RangeLoader",t.message),!1}},o.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),l.prototype.destroy.call(this)},Object.defineProperty(o.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),o.prototype.open=function(r,t){this._dataSource=r,this._range=t,this._status=u.LoaderStatus.kConnecting;var a=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(a=!0,this._totalLength=this._dataSource.filesize),!this._totalLengthReceived&&!a?(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1})):this._openSubRange()},o.prototype._openSubRange=function(){var r=this._currentChunkSizeKB*1024,t=this._range.from+this._receivedLength,a=t+r;this._contentLength!=null&&a-this._range.from>=this._contentLength&&(a=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:a},this._internalOpen(this._dataSource,this._currentRequestRange)},o.prototype._internalOpen=function(r,t){this._lastTimeLoaded=0;var a=r.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?a=this._currentRedirectedURL:r.redirectedURL!=null&&(a=r.redirectedURL));var i=this._seekHandler.getConfig(a,t);this._currentRequestURL=i.url;var e=this._xhr=new XMLHttpRequest;if(e.open("GET",i.url,!0),e.responseType="arraybuffer",e.onreadystatechange=this._onReadyStateChange.bind(this),e.onprogress=this._onProgress.bind(this),e.onload=this._onLoad.bind(this),e.onerror=this._onXhrError.bind(this),r.withCredentials&&(e.withCredentials=!0),typeof i.headers=="object"){var d=i.headers;for(var c in d)d.hasOwnProperty(c)&&e.setRequestHeader(c,d[c])}if(typeof this._config.headers=="object"){var d=this._config.headers;for(var c in d)d.hasOwnProperty(c)&&e.setRequestHeader(c,d[c])}e.send()},o.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=u.LoaderStatus.kComplete},o.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},o.prototype._onReadyStateChange=function(r){var t=r.target;if(t.readyState===2){if(t.responseURL!=null){var a=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&a!==this._currentRedirectedURL&&(this._currentRedirectedURL=a,this._onURLRedirect&&this._onURLRedirect(a))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=u.LoaderStatus.kBuffering}else if(this._status=u.LoaderStatus.kError,this._onError)this._onError(u.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText});else throw new s.RuntimeException("RangeLoader: Http code invalid, "+t.status+" "+t.statusText)}},o.prototype._onProgress=function(r){if(this._status!==u.LoaderStatus.kError){if(this._contentLength===null){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var a=r.total;this._internalAbort(),a!=null&a!==0&&(this._totalLength=a)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var i=r.loaded-this._lastTimeLoaded;this._lastTimeLoaded=r.loaded,this._speedSampler.addBytes(i)}},o.prototype._normalizeSpeed=function(r){var t=this._chunkSizeKBList,a=t.length-1,i=0,e=0,d=a;if(r<t[0])return t[0];for(;e<=d;){if(i=e+Math.floor((d-e)/2),i===a||r>=t[i]&&r<t[i+1])return t[i];t[i]<r?e=i+1:d=i-1}},o.prototype._onLoad=function(r){if(this._status!==u.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(t===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps)),t!==0){var a=this._normalizeSpeed(t);this._currentSpeedNormalized!==a&&(this._currentSpeedNormalized=a,this._currentChunkSizeKB=a)}var i=r.target.response,e=this._range.from+this._receivedLength;this._receivedLength+=i.byteLength;var d=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():d=!0,this._onDataArrival&&this._onDataArrival(i,e,this._receivedLength),d&&(this._status=u.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},o.prototype._onXhrError=function(r){this._status=u.LoaderStatus.kError;var t=0,a=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=u.LoaderErrors.EARLY_EOF,a={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=u.LoaderErrors.EXCEPTION,a={code:-1,msg:r.constructor.name+" "+r.type}),this._onError)this._onError(t,a);else throw new s.RuntimeException(a.msg)},o}(u.BaseLoader);S.default=n},"./src/player/flv-player.js":function(T,S,p){p.r(S);var E=p("./node_modules/events/events.js"),h=p.n(E),u=p("./src/utils/logger.js"),s=p("./src/utils/browser.js"),f=p("./src/player/player-events.js"),n=p("./src/core/transmuxer.js"),l=p("./src/core/transmuxing-events.js"),o=p("./src/core/mse-controller.js"),r=p("./src/core/mse-events.js"),t=p("./src/player/player-errors.js"),a=p("./src/config.js"),i=p("./src/utils/exception.js"),e=function(){function d(c,_){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(h()),this._config=(0,a.createDefaultConfig)(),typeof _=="object"&&Object.assign(this._config,_),c.type.toLowerCase()!=="flv")throw new i.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");c.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=c,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var v=s.default.chrome&&(s.default.version.major<50||s.default.version.major===50&&s.default.version.build<2661);this._alwaysSeekKeyframe=!!(v||s.default.msedge||s.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return d.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},d.prototype.on=function(c,_){var v=this;c===f.default.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){v._emitter.emit(f.default.MEDIA_INFO,v.mediaInfo)}):c===f.default.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){v._emitter.emit(f.default.STATISTICS_INFO,v.statisticsInfo)}),this._emitter.addListener(c,_)},d.prototype.off=function(c,_){this._emitter.removeListener(c,_)},d.prototype.attachMediaElement=function(c){var _=this;if(this._mediaElement=c,c.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),c.addEventListener("seeking",this.e.onvSeeking),c.addEventListener("canplay",this.e.onvCanPlay),c.addEventListener("stalled",this.e.onvStalled),c.addEventListener("progress",this.e.onvProgress),this._msectl=new o.default(this._config),this._msectl.on(r.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(r.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(r.default.SOURCE_OPEN,function(){_._mseSourceOpened=!0,_._hasPendingLoad&&(_._hasPendingLoad=!1,_.load())}),this._msectl.on(r.default.ERROR,function(v){_._emitter.emit(f.default.ERROR,t.ErrorTypes.MEDIA_ERROR,t.ErrorDetails.MEDIA_MSE_ERROR,v)}),this._msectl.attachMediaElement(c),this._pendingSeekTime!=null)try{c.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},d.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},d.prototype.load=function(){var c=this;if(!this._mediaElement)throw new i.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new i.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new n.default(this._mediaDataSource,this._config),this._transmuxer.on(l.default.INIT_SEGMENT,function(_,v){c._msectl.appendInitSegment(v)}),this._transmuxer.on(l.default.MEDIA_SEGMENT,function(_,v){if(c._msectl.appendMediaSegment(v),c._config.lazyLoad&&!c._config.isLive){var y=c._mediaElement.currentTime;v.info.endDts>=(y+c._config.lazyLoadMaxDuration)*1e3&&c._progressChecker==null&&(u.default.v(c.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),c._suspendTransmuxer())}}),this._transmuxer.on(l.default.LOADING_COMPLETE,function(){c._msectl.endOfStream(),c._emitter.emit(f.default.LOADING_COMPLETE)}),this._transmuxer.on(l.default.RECOVERED_EARLY_EOF,function(){c._emitter.emit(f.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(l.default.IO_ERROR,function(_,v){c._emitter.emit(f.default.ERROR,t.ErrorTypes.NETWORK_ERROR,_,v)}),this._transmuxer.on(l.default.DEMUX_ERROR,function(_,v){c._emitter.emit(f.default.ERROR,t.ErrorTypes.MEDIA_ERROR,_,{code:-1,msg:v})}),this._transmuxer.on(l.default.MEDIA_INFO,function(_){c._mediaInfo=_,c._emitter.emit(f.default.MEDIA_INFO,Object.assign({},_))}),this._transmuxer.on(l.default.METADATA_ARRIVED,function(_){c._emitter.emit(f.default.METADATA_ARRIVED,_)}),this._transmuxer.on(l.default.SCRIPTDATA_ARRIVED,function(_){c._emitter.emit(f.default.SCRIPTDATA_ARRIVED,_)}),this._transmuxer.on(l.default.STATISTICS_INFO,function(_){c._statisticsInfo=c._fillStatisticsInfo(_),c._emitter.emit(f.default.STATISTICS_INFO,Object.assign({},c._statisticsInfo))}),this._transmuxer.on(l.default.RECOMMEND_SEEKPOINT,function(_){c._mediaElement&&!c._config.accurateSeek&&(c._requestSetTime=!0,c._mediaElement.currentTime=_/1e3)}),this._transmuxer.open()}},d.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},d.prototype.play=function(){return this._mediaElement.play()},d.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(d.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(c){this._mediaElement.volume=c},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(c){this._mediaElement.muted=c},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(c){this._mediaElement?this._internalSeek(c):this._pendingSeekTime=c},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),d.prototype._fillStatisticsInfo=function(c){if(c.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return c;var _=!0,v=0,y=0;if(this._mediaElement.getVideoPlaybackQuality){var x=this._mediaElement.getVideoPlaybackQuality();v=x.totalVideoFrames,y=x.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(v=this._mediaElement.webkitDecodedFrameCount,y=this._mediaElement.webkitDroppedFrameCount):_=!1;return _&&(c.decodedFrames=v,c.droppedFrames=y),c},d.prototype._onmseUpdateEnd=function(){if(!(!this._config.lazyLoad||this._config.isLive)){for(var c=this._mediaElement.buffered,_=this._mediaElement.currentTime,v=0,y=0;y<c.length;y++){var x=c.start(y),m=c.end(y);if(x<=_&&_<m){v=m;break}}v>=_+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(u.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},d.prototype._onmseBufferFull=function(){u.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},d.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},d.prototype._checkProgressAndResume=function(){for(var c=this._mediaElement.currentTime,_=this._mediaElement.buffered,v=!1,y=0;y<_.length;y++){var x=_.start(y),m=_.end(y);if(c>=x&&c<m){c>=m-this._config.lazyLoadRecoverDuration&&(v=!0);break}}v&&(window.clearInterval(this._progressChecker),this._progressChecker=null,v&&(u.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},d.prototype._isTimepointBuffered=function(c){for(var _=this._mediaElement.buffered,v=0;v<_.length;v++){var y=_.start(v),x=_.end(v);if(c>=y&&c<x)return!0}return!1},d.prototype._internalSeek=function(c){var _=this._isTimepointBuffered(c),v=!1,y=0;if(c<1&&this._mediaElement.buffered.length>0){var x=this._mediaElement.buffered.start(0);(x<1&&c<x||s.default.safari)&&(v=!0,y=s.default.safari?.1:x)}if(v)this._requestSetTime=!0,this._mediaElement.currentTime=y;else if(_){if(!this._alwaysSeekKeyframe)this._requestSetTime=!0,this._mediaElement.currentTime=c;else{var m=this._msectl.getNearestKeyframe(Math.floor(c*1e3));this._requestSetTime=!0,m!=null?this._mediaElement.currentTime=m.dts/1e3:this._mediaElement.currentTime=c}this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(c),this._transmuxer.seek(Math.floor(c*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=c)},d.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var c=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(c)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(c),this._transmuxer.seek(Math.floor(c*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=c))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},d.prototype._checkAndResumeStuckPlayback=function(c){var _=this._mediaElement;if(c||!this._receivedCanPlay||_.readyState<2){var v=_.buffered;v.length>0&&_.currentTime<v.start(0)&&(u.default.w(this.TAG,"Playback seems stuck at "+_.currentTime+", seek to "+v.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=v.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},d.prototype._onvLoadedMetadata=function(c){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},d.prototype._onvSeeking=function(c){var _=this._mediaElement.currentTime,v=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(_<1&&v.length>0){var y=v.start(0);if(y<1&&_<y||s.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=s.default.safari?.1:y;return}}if(this._isTimepointBuffered(_)){if(this._alwaysSeekKeyframe){var x=this._msectl.getNearestKeyframe(Math.floor(_*1e3));x!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=x.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:_,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},d.prototype._onvCanPlay=function(c){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},d.prototype._onvStalled=function(c){this._checkAndResumeStuckPlayback(!0)},d.prototype._onvProgress=function(c){this._checkAndResumeStuckPlayback()},d}();S.default=e},"./src/player/native-player.js":function(T,S,p){p.r(S);var E=p("./node_modules/events/events.js"),h=p.n(E),u=p("./src/player/player-events.js"),s=p("./src/config.js"),f=p("./src/utils/exception.js"),n=function(){function l(o,r){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(h()),this._config=(0,s.createDefaultConfig)(),typeof r=="object"&&Object.assign(this._config,r),o.type.toLowerCase()==="flv")throw new f.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(o.hasOwnProperty("segments"))throw new f.InvalidArgumentException("NativePlayer("+o.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=o,this._mediaElement=null}return l.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},l.prototype.on=function(o,r){var t=this;o===u.default.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){t._emitter.emit(u.default.MEDIA_INFO,t.mediaInfo)}):o===u.default.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){t._emitter.emit(u.default.STATISTICS_INFO,t.statisticsInfo)}),this._emitter.addListener(o,r)},l.prototype.off=function(o,r){this._emitter.removeListener(o,r)},l.prototype.attachMediaElement=function(o){if(this._mediaElement=o,o.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{o.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},l.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},l.prototype.load=function(){if(!this._mediaElement)throw new f.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},l.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},l.prototype.play=function(){return this._mediaElement.play()},l.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(l.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(o){this._mediaElement.volume=o},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(o){this._mediaElement.muted=o},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(o){this._mediaElement?this._mediaElement.currentTime=o:this._pendingSeekTime=o},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"mediaInfo",{get:function(){var o=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",r={mimeType:o+this._mediaDataSource.type};return this._mediaElement&&(r.duration=Math.floor(this._mediaElement.duration*1e3),this._mediaElement instanceof HTMLVideoElement&&(r.width=this._mediaElement.videoWidth,r.height=this._mediaElement.videoHeight)),r},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"statisticsInfo",{get:function(){var o={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return o;var r=!0,t=0,a=0;if(this._mediaElement.getVideoPlaybackQuality){var i=this._mediaElement.getVideoPlaybackQuality();t=i.totalVideoFrames,a=i.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(t=this._mediaElement.webkitDecodedFrameCount,a=this._mediaElement.webkitDroppedFrameCount):r=!1;return r&&(o.decodedFrames=t,o.droppedFrames=a),o},enumerable:!1,configurable:!0}),l.prototype._onvLoadedMetadata=function(o){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(u.default.MEDIA_INFO,this.mediaInfo)},l.prototype._reportStatisticsInfo=function(){this._emitter.emit(u.default.STATISTICS_INFO,this.statisticsInfo)},l}();S.default=n},"./src/player/player-errors.js":function(T,S,p){p.r(S),p.d(S,{ErrorTypes:function(){return u},ErrorDetails:function(){return s}});var E=p("./src/io/loader.js"),h=p("./src/demux/demux-errors.js"),u={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},s={NETWORK_EXCEPTION:E.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:E.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:E.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:E.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:h.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:h.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:h.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(T,S,p){p.r(S);var E={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};S.default=E},"./src/remux/aac-silent.js":function(T,S,p){p.r(S);var E=function(){function h(){}return h.getSilentFrame=function(u,s){if(u==="mp4a.40.2"){if(s===1)return new Uint8Array([0,200,0,128,35,128]);if(s===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(s===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(s===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(s===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(s===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(s===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(s===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(s===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},h}();S.default=E},"./src/remux/mp4-generator.js":function(T,S,p){p.r(S);var E=function(){function h(){}return h.init=function(){h.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var u in h.types)h.types.hasOwnProperty(u)&&(h.types[u]=[u.charCodeAt(0),u.charCodeAt(1),u.charCodeAt(2),u.charCodeAt(3)]);var s=h.constants={};s.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),s.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),s.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),s.STSC=s.STCO=s.STTS,s.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),s.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),s.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),s.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},h.box=function(u){for(var s=8,f=null,n=Array.prototype.slice.call(arguments,1),l=n.length,o=0;o<l;o++)s+=n[o].byteLength;f=new Uint8Array(s),f[0]=s>>>24&255,f[1]=s>>>16&255,f[2]=s>>>8&255,f[3]=s&255,f.set(u,4);for(var r=8,o=0;o<l;o++)f.set(n[o],r),r+=n[o].byteLength;return f},h.generateInitSegment=function(u){var s=h.box(h.types.ftyp,h.constants.FTYP),f=h.moov(u),n=new Uint8Array(s.byteLength+f.byteLength);return n.set(s,0),n.set(f,s.byteLength),n},h.moov=function(u){var s=h.mvhd(u.timescale,u.duration),f=h.trak(u),n=h.mvex(u);return h.box(h.types.moov,s,f,n)},h.mvhd=function(u,s){return h.box(h.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,u>>>24&255,u>>>16&255,u>>>8&255,u&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},h.trak=function(u){return h.box(h.types.trak,h.tkhd(u),h.mdia(u))},h.tkhd=function(u){var s=u.id,f=u.duration,n=u.presentWidth,l=u.presentHeight;return h.box(h.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,0,0,0,0,f>>>24&255,f>>>16&255,f>>>8&255,f&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>>8&255,n&255,0,0,l>>>8&255,l&255,0,0]))},h.mdia=function(u){return h.box(h.types.mdia,h.mdhd(u),h.hdlr(u),h.minf(u))},h.mdhd=function(u){var s=u.timescale,f=u.duration;return h.box(h.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,85,196,0,0]))},h.hdlr=function(u){var s=null;return u.type==="audio"?s=h.constants.HDLR_AUDIO:s=h.constants.HDLR_VIDEO,h.box(h.types.hdlr,s)},h.minf=function(u){var s=null;return u.type==="audio"?s=h.box(h.types.smhd,h.constants.SMHD):s=h.box(h.types.vmhd,h.constants.VMHD),h.box(h.types.minf,s,h.dinf(),h.stbl(u))},h.dinf=function(){var u=h.box(h.types.dinf,h.box(h.types.dref,h.constants.DREF));return u},h.stbl=function(u){var s=h.box(h.types.stbl,h.stsd(u),h.box(h.types.stts,h.constants.STTS),h.box(h.types.stsc,h.constants.STSC),h.box(h.types.stsz,h.constants.STSZ),h.box(h.types.stco,h.constants.STCO));return s},h.stsd=function(u){return u.type==="audio"?u.codec==="mp3"?h.box(h.types.stsd,h.constants.STSD_PREFIX,h.mp3(u)):h.box(h.types.stsd,h.constants.STSD_PREFIX,h.mp4a(u)):h.box(h.types.stsd,h.constants.STSD_PREFIX,h.avc1(u))},h.mp3=function(u){var s=u.channelCount,f=u.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,s,0,16,0,0,0,0,f>>>8&255,f&255,0,0]);return h.box(h.types[".mp3"],n)},h.mp4a=function(u){var s=u.channelCount,f=u.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,s,0,16,0,0,0,0,f>>>8&255,f&255,0,0]);return h.box(h.types.mp4a,n,h.esds(u))},h.esds=function(u){var s=u.config||[],f=s.length,n=new Uint8Array([0,0,0,0,3,23+f,0,1,0,4,15+f,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([f]).concat(s).concat([6,1,2]));return h.box(h.types.esds,n)},h.avc1=function(u){var s=u.avcc,f=u.codecWidth,n=u.codecHeight,l=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>>8&255,f&255,n>>>8&255,n&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return h.box(h.types.avc1,l,h.box(h.types.avcC,s))},h.mvex=function(u){return h.box(h.types.mvex,h.trex(u))},h.trex=function(u){var s=u.id,f=new Uint8Array([0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return h.box(h.types.trex,f)},h.moof=function(u,s){return h.box(h.types.moof,h.mfhd(u.sequenceNumber),h.traf(u,s))},h.mfhd=function(u){var s=new Uint8Array([0,0,0,0,u>>>24&255,u>>>16&255,u>>>8&255,u&255]);return h.box(h.types.mfhd,s)},h.traf=function(u,s){var f=u.id,n=h.box(h.types.tfhd,new Uint8Array([0,0,0,0,f>>>24&255,f>>>16&255,f>>>8&255,f&255])),l=h.box(h.types.tfdt,new Uint8Array([0,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255])),o=h.sdtp(u),r=h.trun(u,o.byteLength+16+16+8+16+8+8);return h.box(h.types.traf,n,l,r,o)},h.sdtp=function(u){for(var s=u.samples||[],f=s.length,n=new Uint8Array(4+f),l=0;l<f;l++){var o=s[l].flags;n[l+4]=o.isLeading<<6|o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy}return h.box(h.types.sdtp,n)},h.trun=function(u,s){var f=u.samples||[],n=f.length,l=12+16*n,o=new Uint8Array(l);s+=8+l,o.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255],0);for(var r=0;r<n;r++){var t=f[r].duration,a=f[r].size,i=f[r].flags,e=f[r].cts;o.set([t>>>24&255,t>>>16&255,t>>>8&255,t&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255,i.isLeading<<2|i.dependsOn,i.isDependedOn<<6|i.hasRedundancy<<4|i.isNonSync,0,0,e>>>24&255,e>>>16&255,e>>>8&255,e&255],12+16*r)}return h.box(h.types.trun,o)},h.mdat=function(u){return h.box(h.types.mdat,u)},h}();E.init(),S.default=E},"./src/remux/mp4-remuxer.js":function(T,S,p){p.r(S);var E=p("./src/utils/logger.js"),h=p("./src/remux/mp4-generator.js"),u=p("./src/remux/aac-silent.js"),s=p("./src/utils/browser.js"),f=p("./src/core/media-segment-info.js"),n=p("./src/utils/exception.js"),l=function(){function o(r){this.TAG="MP4Remuxer",this._config=r,this._isLive=r.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new f.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new f.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!(s.default.chrome&&(s.default.version.major<50||s.default.version.major===50&&s.default.version.build<2661)),this._fillSilentAfterSeek=s.default.msedge||s.default.msie,this._mp3UseMpegAudio=!s.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return o.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},o.prototype.bindDataSource=function(r){return r.onDataAvailable=this.remux.bind(this),r.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(o.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(r){this._onInitSegment=r},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(r){this._onMediaSegment=r},enumerable:!1,configurable:!0}),o.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},o.prototype.seek=function(r){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},o.prototype.remux=function(r,t){if(!this._onMediaSegment)throw new n.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(r,t),this._remuxVideo(t),this._remuxAudio(r)},o.prototype._onTrackMetadataReceived=function(r,t){var a=null,i="mp4",e=t.codec;if(r==="audio")this._audioMeta=t,t.codec==="mp3"&&this._mp3UseMpegAudio?(i="mpeg",e="",a=new Uint8Array):a=h.default.generateInitSegment(t);else if(r==="video")this._videoMeta=t,a=h.default.generateInitSegment(t);else return;if(!this._onInitSegment)throw new n.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(r,{type:r,data:a.buffer,codec:e,container:r+"/"+i,mediaDuration:t.duration})},o.prototype._calculateDtsBase=function(r,t){this._dtsBaseInited||(r.samples&&r.samples.length&&(this._audioDtsBase=r.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},o.prototype.flushStashedSamples=function(){var r=this._videoStashedLastSample,t=this._audioStashedLastSample,a={type:"video",id:1,sequenceNumber:0,samples:[],length:0};r!=null&&(a.samples.push(r),a.length=r.length);var i={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};t!=null&&(i.samples.push(t),i.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(a,!0),this._remuxAudio(i,!0)},o.prototype._remuxAudio=function(r,t){if(this._audioMeta!=null){var a=r,i=a.samples,e=void 0,d=-1,c=-1,_=this._audioMeta.refSampleDuration,v=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,y=this._dtsBaseInited&&this._audioNextDts===void 0,x=!1;if(!(!i||i.length===0)&&!(i.length===1&&!t)){var m=0,g=null,b=0;v?(m=0,b=a.length):(m=8,b=8+a.length);var C=null;if(i.length>1&&(C=i.pop(),b-=C.length),this._audioStashedLastSample!=null){var O=this._audioStashedLastSample;this._audioStashedLastSample=null,i.unshift(O),b+=O.length}C!=null&&(this._audioStashedLastSample=C);var M=i[0].dts-this._dtsBase;if(this._audioNextDts)e=M-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())e=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(x=!0);else{var G=this._audioSegmentInfoList.getLastSampleBefore(M);if(G!=null){var W=M-(G.originalDts+G.duration);W<=3&&(W=0);var V=G.dts+G.duration+W;e=M-V}else e=0}if(x){var X=M-e,te=this._videoSegmentInfoList.getLastSegmentBefore(M);if(te!=null&&te.beginDts<X){var N=u.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(N){var Z=te.beginDts,ae=X-te.beginDts;E.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+Z+", duration: "+ae),i.unshift({unit:N,dts:Z,pts:Z}),b+=N.byteLength}}else x=!1}for(var q=[],L=0;L<i.length;L++){var O=i[L],j=O.unit,k=O.dts-this._dtsBase,Z=k,$=!1,ee=null,z=0;if(!(k<-.001)){if(this._audioMeta.codec!=="mp3"){var w=k,re=3;if(this._audioNextDts&&(w=this._audioNextDts),e=k-w,e<=-re*_){E.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+k+" ms ,curRefDts: "+w+" ms)  due to dtsCorrection: "+e+" ms overlap.");continue}else if(e>=re*_&&this._fillAudioTimestampGap&&!s.default.safari){$=!0;var se=Math.floor(e/_);E.default.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+("originalDts: "+k+" ms, curRefDts: "+w+" ms, ")+("dtsCorrection: "+Math.round(e)+" ms, generate: "+se+" frames")),Z=Math.floor(w),z=Math.floor(w+_)-Z;var N=u.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);N==null&&(E.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),N=j),ee=[];for(var ve=0;ve<se;ve++){w=w+_;var fe=Math.floor(w),pe=Math.floor(w+_)-fe,ge={dts:fe,pts:fe,cts:0,unit:N,size:N.byteLength,duration:pe,originalDts:k,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};ee.push(ge),b+=ge.size}this._audioNextDts=w+_}else Z=Math.floor(w),z=Math.floor(w+_)-Z,this._audioNextDts=w+_}else{if(Z=k-e,L!==i.length-1){var xe=i[L+1].dts-this._dtsBase-e;z=xe-Z}else if(C!=null){var xe=C.dts-this._dtsBase-e;z=xe-Z}else q.length>=1?z=q[q.length-1].duration:z=Math.floor(_);this._audioNextDts=Z+z}d===-1&&(d=Z),q.push({dts:Z,pts:Z,cts:0,unit:O.unit,size:O.unit.byteLength,duration:z,originalDts:k,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),$&&q.push.apply(q,ee)}}if(q.length===0){a.samples=[],a.length=0;return}v?g=new Uint8Array(b):(g=new Uint8Array(b),g[0]=b>>>24&255,g[1]=b>>>16&255,g[2]=b>>>8&255,g[3]=b&255,g.set(h.default.types.mdat,4));for(var L=0;L<q.length;L++){var j=q[L].unit;g.set(j,m),m+=j.byteLength}var de=q[q.length-1];c=de.dts+de.duration;var oe=new f.MediaSegmentInfo;oe.beginDts=d,oe.endDts=c,oe.beginPts=d,oe.endPts=c,oe.originalBeginDts=q[0].originalDts,oe.originalEndDts=de.originalDts+de.duration,oe.firstSample=new f.SampleInfo(q[0].dts,q[0].pts,q[0].duration,q[0].originalDts,!1),oe.lastSample=new f.SampleInfo(de.dts,de.pts,de.duration,de.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(oe),a.samples=q,a.sequenceNumber++;var Re=null;v?Re=new Uint8Array:Re=h.default.moof(a,d),a.samples=[],a.length=0;var Oe={type:"audio",data:this._mergeBoxes(Re,g).buffer,sampleCount:q.length,info:oe};v&&y&&(Oe.timestampOffset=d),this._onMediaSegment("audio",Oe)}}},o.prototype._remuxVideo=function(r,t){if(this._videoMeta!=null){var a=r,i=a.samples,e=void 0,d=-1,c=-1,_=-1,v=-1;if(!(!i||i.length===0)&&!(i.length===1&&!t)){var y=8,x=null,m=8+r.length,g=null;if(i.length>1&&(g=i.pop(),m-=g.length),this._videoStashedLastSample!=null){var b=this._videoStashedLastSample;this._videoStashedLastSample=null,i.unshift(b),m+=b.length}g!=null&&(this._videoStashedLastSample=g);var C=i[0].dts-this._dtsBase;if(this._videoNextDts)e=C-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())e=0;else{var O=this._videoSegmentInfoList.getLastSampleBefore(C);if(O!=null){var M=C-(O.originalDts+O.duration);M<=3&&(M=0);var G=O.dts+O.duration+M;e=C-G}else e=0}for(var W=new f.MediaSegmentInfo,V=[],X=0;X<i.length;X++){var b=i[X],te=b.dts-this._dtsBase,N=b.isKeyframe,Z=te-e,ae=b.cts,q=Z+ae;d===-1&&(d=Z,_=q);var L=0;if(X!==i.length-1){var j=i[X+1].dts-this._dtsBase-e;L=j-Z}else if(g!=null){var j=g.dts-this._dtsBase-e;L=j-Z}else V.length>=1?L=V[V.length-1].duration:L=Math.floor(this._videoMeta.refSampleDuration);if(N){var k=new f.SampleInfo(Z,q,L,b.dts,!0);k.fileposition=b.fileposition,W.appendSyncPoint(k)}V.push({dts:Z,pts:q,cts:ae,units:b.units,size:b.length,isKeyframe:N,duration:L,originalDts:te,flags:{isLeading:0,dependsOn:N?2:1,isDependedOn:N?1:0,hasRedundancy:0,isNonSync:N?0:1}})}x=new Uint8Array(m),x[0]=m>>>24&255,x[1]=m>>>16&255,x[2]=m>>>8&255,x[3]=m&255,x.set(h.default.types.mdat,4);for(var X=0;X<V.length;X++)for(var $=V[X].units;$.length;){var ee=$.shift(),z=ee.data;x.set(z,y),y+=z.byteLength}var w=V[V.length-1];if(c=w.dts+w.duration,v=w.pts+w.duration,this._videoNextDts=c,W.beginDts=d,W.endDts=c,W.beginPts=_,W.endPts=v,W.originalBeginDts=V[0].originalDts,W.originalEndDts=w.originalDts+w.duration,W.firstSample=new f.SampleInfo(V[0].dts,V[0].pts,V[0].duration,V[0].originalDts,V[0].isKeyframe),W.lastSample=new f.SampleInfo(w.dts,w.pts,w.duration,w.originalDts,w.isKeyframe),this._isLive||this._videoSegmentInfoList.append(W),a.samples=V,a.sequenceNumber++,this._forceFirstIDR){var re=V[0].flags;re.dependsOn=2,re.isNonSync=0}var se=h.default.moof(a,d);a.samples=[],a.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(se,x).buffer,sampleCount:V.length,info:W})}}},o.prototype._mergeBoxes=function(r,t){var a=new Uint8Array(r.byteLength+t.byteLength);return a.set(r,0),a.set(t,r.byteLength),a},o}();S.default=l},"./src/utils/browser.js":function(T,S,p){p.r(S);var E={};function h(){var u=self.navigator.userAgent.toLowerCase(),s=/(edge)\/([\w.]+)/.exec(u)||/(opr)[\/]([\w.]+)/.exec(u)||/(chrome)[ \/]([\w.]+)/.exec(u)||/(iemobile)[\/]([\w.]+)/.exec(u)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(u)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(u)||/(webkit)[ \/]([\w.]+)/.exec(u)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(u)||/(msie) ([\w.]+)/.exec(u)||u.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(u)||u.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(u)||[],f=/(ipad)/.exec(u)||/(ipod)/.exec(u)||/(windows phone)/.exec(u)||/(iphone)/.exec(u)||/(kindle)/.exec(u)||/(android)/.exec(u)||/(windows)/.exec(u)||/(mac)/.exec(u)||/(linux)/.exec(u)||/(cros)/.exec(u)||[],n={browser:s[5]||s[3]||s[1]||"",version:s[2]||s[4]||"0",majorVersion:s[4]||s[2]||"0",platform:f[0]||""},l={};if(n.browser){l[n.browser]=!0;var o=n.majorVersion.split(".");l.version={major:parseInt(n.majorVersion,10),string:n.version},o.length>1&&(l.version.minor=parseInt(o[1],10)),o.length>2&&(l.version.build=parseInt(o[2],10))}if(n.platform&&(l[n.platform]=!0),(l.chrome||l.opr||l.safari)&&(l.webkit=!0),l.rv||l.iemobile){l.rv&&delete l.rv;var r="msie";n.browser=r,l[r]=!0}if(l.edge){delete l.edge;var t="msedge";n.browser=t,l[t]=!0}if(l.opr){var a="opera";n.browser=a,l[a]=!0}if(l.safari&&l.android){var i="android";n.browser=i,l[i]=!0}l.name=n.browser,l.platform=n.platform;for(var e in E)E.hasOwnProperty(e)&&delete E[e];Object.assign(E,l)}h(),S.default=E},"./src/utils/exception.js":function(T,S,p){p.r(S),p.d(S,{RuntimeException:function(){return h},IllegalStateException:function(){return u},InvalidArgumentException:function(){return s},NotImplementedException:function(){return f}});var E=function(){var n=function(l,o){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])},n(l,o)};return function(l,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");n(l,o);function r(){this.constructor=l}l.prototype=o===null?Object.create(o):(r.prototype=o.prototype,new r)}}(),h=function(){function n(l){this._message=l}return Object.defineProperty(n.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),n.prototype.toString=function(){return this.name+": "+this.message},n}(),u=function(n){E(l,n);function l(o){return n.call(this,o)||this}return Object.defineProperty(l.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),l}(h),s=function(n){E(l,n);function l(o){return n.call(this,o)||this}return Object.defineProperty(l.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),l}(h),f=function(n){E(l,n);function l(o){return n.call(this,o)||this}return Object.defineProperty(l.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),l}(h)},"./src/utils/logger.js":function(T,S,p){p.r(S);var E=p("./node_modules/events/events.js"),h=p.n(E),u=function(){function s(){}return s.e=function(f,n){(!f||s.FORCE_GLOBAL_TAG)&&(f=s.GLOBAL_TAG);var l="["+f+"] > "+n;s.ENABLE_CALLBACK&&s.emitter.emit("log","error",l),s.ENABLE_ERROR&&(console.error?console.error(l):console.warn?console.warn(l):console.log(l))},s.i=function(f,n){(!f||s.FORCE_GLOBAL_TAG)&&(f=s.GLOBAL_TAG);var l="["+f+"] > "+n;s.ENABLE_CALLBACK&&s.emitter.emit("log","info",l),s.ENABLE_INFO&&(console.info?console.info(l):console.log(l))},s.w=function(f,n){(!f||s.FORCE_GLOBAL_TAG)&&(f=s.GLOBAL_TAG);var l="["+f+"] > "+n;s.ENABLE_CALLBACK&&s.emitter.emit("log","warn",l),s.ENABLE_WARN&&(console.warn?console.warn(l):console.log(l))},s.d=function(f,n){(!f||s.FORCE_GLOBAL_TAG)&&(f=s.GLOBAL_TAG);var l="["+f+"] > "+n;s.ENABLE_CALLBACK&&s.emitter.emit("log","debug",l),s.ENABLE_DEBUG&&(console.debug?console.debug(l):console.log(l))},s.v=function(f,n){(!f||s.FORCE_GLOBAL_TAG)&&(f=s.GLOBAL_TAG);var l="["+f+"] > "+n;s.ENABLE_CALLBACK&&s.emitter.emit("log","verbose",l),s.ENABLE_VERBOSE&&console.log(l)},s}();u.GLOBAL_TAG="flv.js",u.FORCE_GLOBAL_TAG=!1,u.ENABLE_ERROR=!0,u.ENABLE_INFO=!0,u.ENABLE_WARN=!0,u.ENABLE_DEBUG=!0,u.ENABLE_VERBOSE=!0,u.ENABLE_CALLBACK=!1,u.emitter=new(h()),S.default=u},"./src/utils/logging-control.js":function(T,S,p){p.r(S);var E=p("./node_modules/events/events.js"),h=p.n(E),u=p("./src/utils/logger.js"),s=function(){function f(){}return Object.defineProperty(f,"forceGlobalTag",{get:function(){return u.default.FORCE_GLOBAL_TAG},set:function(n){u.default.FORCE_GLOBAL_TAG=n,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"globalTag",{get:function(){return u.default.GLOBAL_TAG},set:function(n){u.default.GLOBAL_TAG=n,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableAll",{get:function(){return u.default.ENABLE_VERBOSE&&u.default.ENABLE_DEBUG&&u.default.ENABLE_INFO&&u.default.ENABLE_WARN&&u.default.ENABLE_ERROR},set:function(n){u.default.ENABLE_VERBOSE=n,u.default.ENABLE_DEBUG=n,u.default.ENABLE_INFO=n,u.default.ENABLE_WARN=n,u.default.ENABLE_ERROR=n,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableDebug",{get:function(){return u.default.ENABLE_DEBUG},set:function(n){u.default.ENABLE_DEBUG=n,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableVerbose",{get:function(){return u.default.ENABLE_VERBOSE},set:function(n){u.default.ENABLE_VERBOSE=n,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableInfo",{get:function(){return u.default.ENABLE_INFO},set:function(n){u.default.ENABLE_INFO=n,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableWarn",{get:function(){return u.default.ENABLE_WARN},set:function(n){u.default.ENABLE_WARN=n,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableError",{get:function(){return u.default.ENABLE_ERROR},set:function(n){u.default.ENABLE_ERROR=n,f._notifyChange()},enumerable:!1,configurable:!0}),f.getConfig=function(){return{globalTag:u.default.GLOBAL_TAG,forceGlobalTag:u.default.FORCE_GLOBAL_TAG,enableVerbose:u.default.ENABLE_VERBOSE,enableDebug:u.default.ENABLE_DEBUG,enableInfo:u.default.ENABLE_INFO,enableWarn:u.default.ENABLE_WARN,enableError:u.default.ENABLE_ERROR,enableCallback:u.default.ENABLE_CALLBACK}},f.applyConfig=function(n){u.default.GLOBAL_TAG=n.globalTag,u.default.FORCE_GLOBAL_TAG=n.forceGlobalTag,u.default.ENABLE_VERBOSE=n.enableVerbose,u.default.ENABLE_DEBUG=n.enableDebug,u.default.ENABLE_INFO=n.enableInfo,u.default.ENABLE_WARN=n.enableWarn,u.default.ENABLE_ERROR=n.enableError,u.default.ENABLE_CALLBACK=n.enableCallback},f._notifyChange=function(){var n=f.emitter;if(n.listenerCount("change")>0){var l=f.getConfig();n.emit("change",l)}},f.registerListener=function(n){f.emitter.addListener("change",n)},f.removeListener=function(n){f.emitter.removeListener("change",n)},f.addLogListener=function(n){u.default.emitter.addListener("log",n),u.default.emitter.listenerCount("log")>0&&(u.default.ENABLE_CALLBACK=!0,f._notifyChange())},f.removeLogListener=function(n){u.default.emitter.removeListener("log",n),u.default.emitter.listenerCount("log")===0&&(u.default.ENABLE_CALLBACK=!1,f._notifyChange())},f}();s.emitter=new(h()),S.default=s},"./src/utils/polyfill.js":function(T,S,p){p.r(S);var E=function(){function h(){}return h.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(u,s){return u.__proto__=s,u},Object.assign=Object.assign||function(u){if(u==null)throw new TypeError("Cannot convert undefined or null to object");for(var s=Object(u),f=1;f<arguments.length;f++){var n=arguments[f];if(n!=null)for(var l in n)n.hasOwnProperty(l)&&(s[l]=n[l])}return s},typeof self.Promise!="function"&&p("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},h}();E.install(),S.default=E},"./src/utils/utf8-conv.js":function(T,S,p){p.r(S);function E(u,s,f){var n=u;if(s+f<n.length){for(;f--;)if((n[++s]&192)!==128)return!1;return!0}else return!1}function h(u){for(var s=[],f=u,n=0,l=u.length;n<l;){if(f[n]<128){s.push(String.fromCharCode(f[n])),++n;continue}else if(!(f[n]<192)){if(f[n]<224){if(E(f,n,1)){var o=(f[n]&31)<<6|f[n+1]&63;if(o>=128){s.push(String.fromCharCode(o&65535)),n+=2;continue}}}else if(f[n]<240){if(E(f,n,2)){var o=(f[n]&15)<<12|(f[n+1]&63)<<6|f[n+2]&63;if(o>=2048&&(o&63488)!==55296){s.push(String.fromCharCode(o&65535)),n+=3;continue}}}else if(f[n]<248&&E(f,n,3)){var o=(f[n]&7)<<18|(f[n+1]&63)<<12|(f[n+2]&63)<<6|f[n+3]&63;if(o>65536&&o<1114112){o-=65536,s.push(String.fromCharCode(o>>>10|55296)),s.push(String.fromCharCode(o&1023|56320)),n+=4;continue}}}s.push(""),++n}return s.join("")}S.default=h}},J={};function P(T){var S=J[T];if(S!==void 0)return S.exports;var p=J[T]={exports:{}};return F[T].call(p.exports,p,p.exports,P),p.exports}P.m=F,function(){P.n=function(T){var S=T&&T.__esModule?function(){return T.default}:function(){return T};return P.d(S,{a:S}),S}}(),function(){P.d=function(T,S){for(var p in S)P.o(S,p)&&!P.o(T,p)&&Object.defineProperty(T,p,{enumerable:!0,get:S[p]})}}(),function(){P.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()}(),function(){P.o=function(T,S){return Object.prototype.hasOwnProperty.call(T,S)}}(),function(){P.r=function(T){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(T,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(T,"__esModule",{value:!0})}}();var Y=P("./src/index.js");return Y}()})})(rt);var or=rt.exports;const Ve=Ot(or);class lr{constructor(U,F){this.sourceId=U,this.canvasId=F}init(){this.source=document.getElementById(this.sourceId),this.canvas=document.getElementById(this.canvasId),this.canvasContext=this.canvas.getContext("2d")}destroyPlayer(){this.player&&(this.player.pause(),this.player.unload(),this.player.detachMediaElement(),this.player.destroy())}connect(U){this.player&&this.destroyPlayer(),Ve.isSupported()&&(this.player=Ve.createPlayer({type:"flv",isLive:!0,url:U},{enableStashBuffer:!1,stashInitialSize:128}),this.player.attachMediaElement(this.source),this.player.load(),this.player.play(),this.player.on(Ve.Events.ERROR,F=>{err.value=F}))}play(U){Ct.client.on("camera:data",({hands:F,fingers:J})=>{this.canvasContext.drawImage(this.source,0,0,640,360);for(const P in F){this.canvasContext.strokeStyle="green",console.log(J[P].curlNum);const Y=F[P].y1-F[P].y0,T=F[P].x1-F[P].x0;this.canvasContext.strokeRect(F[P].x0,F[P].y0,T,Y),this.canvasContext.strokeText(`hand[${P}]`,F[P].x0,F[P].y0)}})}pause(){this.player.pause(),clearInterval(this.timer)}callback(){this.canvasContext.drawImage(this.source,0,0,640,360)}}const ur=_e("div",null,[_e("video",{id:"source","h-0":""}),_e("div",{"bg-gray-200":""},[_e("canvas",{id:"canvas",width:"640",height:"360"})])],-1),dr=Ae({__name:"CameraMonitor",setup(A){const U=me(""),F=`wss://${document.domain}:${window.location.port}/stream?${Tt.value}`,J=new lr("source","canvas");return Ze(()=>{J.init()}),(P,Y)=>{const T=Je;return Me(),Ge("div",null,[ur,_e("div",null,We(ce(U)),1),Q(T,{type:"primary",onClick:Y[0]||(Y[0]=S=>ce(J).connect(F))},{default:ue(()=>[Le("  ")]),_:1}),Q(T,{type:"primary",onClick:Y[1]||(Y[1]=S=>ce(J).play())},{default:ue(()=>[Le(" play ")]),_:1}),_e("div",null,"error: "+We(ce(U)),1)])}}}),fr={"mt-2em":"","w-100vw":""},hr=_e("span",{"i-fluent:camera-dome-24-filled":"","text-lg":""},null,-1),cr={class:"custom-title"},_r={style:{margin:"16px"}},yr=Ae({__name:"camera",setup(A){const{isFetching:U,data:F,error:J,execute:P}=He("/api/camera/list").json(),Y=me(!1),T=me("admin"),S=me("123456"),p=me("");function E(u){Y.value=!0,p.value=u}function h(){const u={username:T.value,password:S.value,urn:p.value};He("/api/camera/login").post(u).json()}return(u,s)=>{const f=qe,n=dr,l=wt,o=ar,r=tr,t=Je,a=Zt,i=Vt,e=Ft;return Me(),Ge("div",fr,[Q(l,{inset:""},{default:ue(()=>[Q(f,{title:"192.168.128.34"}),Q(f,null,{default:ue(()=>[Q(n)]),_:1})]),_:1}),Q(o),Q(l,{inset:""},{default:ue(()=>{var d;return[(Me(!0),Ge(It,null,Dt(((d=ce(F))==null?void 0:d.list)??[],(c,_)=>(Me(),Mt(f,{key:_,"is-link":"","arrow-direction":"up",onClick:v=>E(c.urn)},{title:ue(()=>[hr,_e("span",cr,We(c.hostname),1),Q(r,{type:"primary"},{default:ue(()=>[Le("  ")]),_:1})]),_:2},1032,["onClick"]))),128))]}),_:1}),Q(t,{onClick:s[0]||(s[0]=()=>{ce(P)()})},{default:ue(()=>[Le(" refresh ")]),_:1}),Q(e,{show:ce(Y),"onUpdate:show":s[4]||(s[4]=d=>je(Y)?Y.value=d:null),round:"",style:{padding:"1em"}},{default:ue(()=>[Q(i,{onSubmit:s[3]||(s[3]=d=>h())},{default:ue(()=>[Q(l,{inset:""},{default:ue(()=>[Q(a,{modelValue:ce(T),"onUpdate:modelValue":s[1]||(s[1]=d=>je(T)?T.value=d:null),name:"",label:"",placeholder:"",rules:[{required:!0,message:""}]},null,8,["modelValue"]),Q(a,{modelValue:ce(S),"onUpdate:modelValue":s[2]||(s[2]=d=>je(S)?S.value=d:null),type:"password",name:"",label:"",placeholder:"",rules:[{required:!0,message:""}]},null,8,["modelValue"])]),_:1}),_e("div",_r,[Q(t,{round:"",block:"",type:"primary","native-type":"submit"},{default:ue(()=>[Le("  ")]),_:1})])]),_:1})]),_:1},8,["show"])])}}});export{yr as default};
